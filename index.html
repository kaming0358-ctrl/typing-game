<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚¿ã‚¤ãƒ”ãƒ³ã‚°å¤§ä½œæˆ¦ï¼</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Kaisei+Decol:wght@400;700&family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap');
:root {
  --bg:#0d1117; --panel:#161b26; --panel2:#1c2333;
  --accent:#00e5ff; --accent2:#ff6b35; --accent3:#a855f7;
  --green:#69f0ae; --red:#ff5252; --yellow:#ffd740; --text:#e8eaf6;
  --fp:#ff6b6b; --fr:#ffa94d; --fm:#69db7c; --fi:#4dabf7; --ft:#da77f2;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'M PLUS Rounded 1c',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;}
#stars{position:fixed;inset:0;pointer-events:none;z-index:0;}
.star{position:absolute;background:white;border-radius:50%;animation:twinkle var(--d,3s) ease-in-out infinite alternate;animation-delay:var(--dl,0s);}
@keyframes twinkle{from{opacity:.15}to{opacity:.9}}
.screen{position:relative;z-index:1;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:20px;}
.hidden{display:none!important;}
.btn{background:linear-gradient(135deg,var(--accent),#0288d1);border:none;border-radius:50px;padding:14px 48px;font-family:'M PLUS Rounded 1c',sans-serif;font-size:1.3rem;font-weight:800;color:#000;cursor:pointer;transition:transform .15s,box-shadow .15s;box-shadow:0 0 20px rgba(0,229,255,.5);}
.btn:hover{transform:scale(1.07);box-shadow:0 0 35px rgba(0,229,255,.8);}
.btn:active{transform:scale(.97);}
.btn-sub{background:linear-gradient(135deg,var(--accent3),#7c3aed);color:white;box-shadow:0 0 20px rgba(168,85,247,.5);}
.btn-sub:hover{box-shadow:0 0 35px rgba(168,85,247,.8);}

/* ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ */
.license-box{background:var(--panel);border:1px solid rgba(0,229,255,.25);border-radius:20px;padding:40px 36px;width:100%;max-width:400px;text-align:center;box-shadow:0 0 40px rgba(0,229,255,.1);}
.license-icon{font-size:3rem;margin-bottom:12px;}
.license-box h2{font-family:'Kaisei Decol',serif;font-size:1.6rem;color:var(--accent);margin-bottom:8px;}
.license-box p{font-size:.88rem;color:#90caf9;margin-bottom:20px;}
#license-input{background:var(--panel2);border:2px solid rgba(0,229,255,.3);border-radius:10px;padding:12px 16px;font-family:'M PLUS Rounded 1c',sans-serif;font-size:1.1rem;color:white;width:100%;outline:none;margin-bottom:10px;text-align:center;letter-spacing:.15em;}
#license-input:focus{border-color:var(--accent);box-shadow:0 0 12px rgba(0,229,255,.3);}
.license-error{color:var(--red);font-size:.85rem;font-weight:700;min-height:24px;margin-bottom:12px;}

/* ã‚¿ã‚¤ãƒˆãƒ« */
#title-screen h1{font-family:'Kaisei Decol',serif;font-size:clamp(2rem,6vw,3.8rem);text-align:center;line-height:1.3;color:var(--accent);text-shadow:0 0 30px var(--accent);animation:glow 2s ease-in-out infinite alternate;margin-bottom:.4em;}
@keyframes glow{from{text-shadow:0 0 20px var(--accent);}to{text-shadow:0 0 50px var(--accent),0 0 100px var(--accent);}}
#title-screen>p{font-size:1rem;color:#90caf9;margin-bottom:1.5rem;text-align:center;}
.rules-box{background:rgba(255,255,255,.04);border:1px solid rgba(0,229,255,.2);border-radius:14px;padding:16px 24px;margin-bottom:1.5rem;max-width:420px;width:100%;}
.rules-box h3{color:var(--yellow);font-size:.9rem;margin-bottom:8px;letter-spacing:.1em;}
.rule-item{display:flex;align-items:center;gap:8px;font-size:.85rem;color:#cdd5e0;margin-bottom:5px;}
.finger-legend{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px 20px;margin-bottom:1.2rem;max-width:420px;width:100%;}
.legend-item{display:flex;align-items:center;gap:6px;font-size:.82rem;}
.legend-dot{width:16px;height:16px;border-radius:50%;}
.category-select{background:rgba(255,255,255,.04);border:1px solid rgba(0,229,255,.2);border-radius:14px;padding:16px 20px;margin-bottom:1.2rem;max-width:480px;width:100%;}
.category-select h3{color:var(--yellow);font-size:.9rem;margin-bottom:12px;letter-spacing:.1em;text-align:center;}
.cat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.cat-btn{background:rgba(255,255,255,.05);border:2px solid rgba(255,255,255,.12);border-radius:10px;padding:10px 6px;font-family:'M PLUS Rounded 1c',sans-serif;font-size:.78rem;font-weight:700;color:#cdd5e0;cursor:pointer;transition:all .15s;text-align:center;line-height:1.4;}
.cat-btn:hover{background:rgba(0,229,255,.1);border-color:var(--accent);color:var(--accent);}
.cat-btn.selected{background:rgba(0,229,255,.18);border-color:var(--accent);color:var(--accent);box-shadow:0 0 12px rgba(0,229,255,.4);}

/* ã‚²ãƒ¼ãƒ  */
#game-screen{justify-content:flex-start;padding-top:12px;}
.game-header{width:100%;max-width:880px;display:flex;align-items:center;justify-content:space-between;padding:10px 20px;background:rgba(22,27,38,.95);border:1px solid rgba(0,229,255,.15);border-radius:16px 16px 0 0;}
.hud-item{text-align:center;}
.hud-label{font-size:.65rem;color:#90caf9;letter-spacing:.1em;text-transform:uppercase;}
.hud-value{font-size:1.5rem;font-weight:800;color:var(--accent);}
#timer-value{color:var(--accent2);}
#timer-value.danger{color:var(--red);animation:blink .4s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.4}}
#timer-wrap{position:relative;display:inline-block;}
#penalty-flash{position:absolute;top:-18px;left:50%;transform:translateX(-50%);color:var(--red);font-size:.75rem;font-weight:800;opacity:0;white-space:nowrap;pointer-events:none;}
#penalty-flash.show{animation:pfpop .7s ease-out forwards;}
@keyframes pfpop{0%{opacity:1;transform:translateX(-50%) translateY(0);}100%{opacity:0;transform:translateX(-50%) translateY(-20px);}}
#combo-wrap{position:relative;display:flex;flex-direction:column;align-items:center;}
#combo-value{font-size:1.5rem;font-weight:800;color:var(--yellow);}
#combo-value.lv1{color:var(--green);}
#combo-value.lv2{color:var(--accent2);text-shadow:0 0 12px var(--accent2);}
#combo-value.lv3{color:var(--red);animation:cfire .6s infinite alternate;}
@keyframes cfire{from{text-shadow:0 0 10px var(--red);}to{text-shadow:0 0 28px var(--red),0 0 50px orange;}}
#combo-value.bump{animation:cbump .18s ease-out;}
@keyframes cbump{0%{transform:scale(1);}50%{transform:scale(1.4);}100%{transform:scale(1);}}
#combo-reset-flash{position:absolute;bottom:-16px;left:50%;transform:translateX(-50%);color:var(--red);font-size:.65rem;font-weight:800;white-space:nowrap;opacity:0;pointer-events:none;}
#combo-reset-flash.show{animation:pfpop .6s ease-out forwards;}
.game-area{width:100%;max-width:880px;background:var(--panel);border:1px solid rgba(0,229,255,.12);border-top:none;border-radius:0 0 16px 16px;padding:16px 16px 14px;display:flex;flex-direction:column;align-items:center;gap:14px;}
.progress-bar-wrap{width:100%;height:5px;background:rgba(255,255,255,.07);border-radius:3px;overflow:hidden;}
.progress-bar-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--accent),var(--accent3));transition:width .5s linear,background .5s;}
.monster-stage{width:100%;height:160px;position:relative;overflow:hidden;background:radial-gradient(ellipse 80% 40% at 50% 100%,rgba(168,85,247,.18) 0%,transparent 70%),linear-gradient(180deg,rgba(5,5,20,1) 0%,rgba(20,14,40,.85) 100%);border-radius:12px;border:1px solid rgba(168,85,247,.25);}
.monster-stage::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent,rgba(168,85,247,.9),transparent);}
#monster{position:absolute;left:50%;bottom:8px;transform:translateX(-50%) scale(var(--ms,.15));transform-origin:bottom center;font-size:5rem;line-height:1;opacity:var(--mo,.2);filter:drop-shadow(0 0 10px rgba(168,85,247,.9));transition:filter .15s;}
#monster.hurt{filter:drop-shadow(0 0 30px red) brightness(3)!important;animation:mhurt .3s ease-out;}
@keyframes mhurt{0%{transform:translateX(-50%) scale(var(--ms,1)) skewX(0);}30%{transform:translateX(-40%) scale(calc(var(--ms,1)*1.1)) skewX(-10deg);}100%{transform:translateX(-50%) scale(var(--ms,1)) skewX(0);}}
#monster.explode{animation:mexplode .45s ease-out forwards!important;}
@keyframes mexplode{0%{transform:translateX(-50%) scale(var(--ms,1));opacity:1;filter:brightness(4) drop-shadow(0 0 30px orange);}50%{transform:translateX(-50%) scale(calc(var(--ms,1)*2.5));opacity:.8;}100%{transform:translateX(-50%) scale(0);opacity:0;}}
#word-bubble{position:absolute;left:50%;transform:translateX(-50%);background:var(--panel2);border:2px solid var(--accent3);border-radius:12px;padding:6px 16px;font-family:'Kaisei Decol',serif;font-size:1.1rem;font-weight:700;color:white;white-space:nowrap;box-shadow:0 0 16px rgba(168,85,247,.5);pointer-events:none;}
#word-bubble::after{content:'';position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);border:5px solid transparent;border-top-color:var(--accent3);}
.input-section{width:100%;background:var(--panel2);border:1px solid rgba(0,229,255,.18);border-radius:14px;padding:14px 20px;display:flex;flex-direction:column;align-items:center;gap:8px;}
.input-display{display:flex;gap:5px;flex-wrap:wrap;justify-content:center;min-height:48px;align-items:center;}
.char-box{width:38px;height:44px;border:2px solid rgba(255,255,255,.15);border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;font-weight:700;background:rgba(255,255,255,.03);transition:all .1s;}
.char-box.ok{border-color:var(--green);color:var(--green);background:rgba(105,240,174,.12);}
.char-box.ng{border-color:var(--red);color:var(--red);background:rgba(255,82,82,.15);animation:shake .3s;}
.char-box.cur{border-color:var(--accent);box-shadow:0 0 12px var(--accent);animation:pulsebox 1s infinite;}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
@keyframes pulsebox{0%,100%{box-shadow:0 0 7px var(--accent)}50%{box-shadow:0 0 18px var(--accent)}}
.romaji-guide{font-size:1.05rem;letter-spacing:.18em;min-height:24px;}
.romaji-guide .done{color:var(--green);}
.romaji-guide .next{color:var(--accent);font-weight:700;}
.romaji-guide .rest{color:#3a4455;}
.feedback-msg{font-size:1.4rem;font-weight:800;min-height:38px;text-align:center;}
.feedback-msg.ok{color:var(--green);text-shadow:0 0 20px var(--green);}
.feedback-msg.ng{color:var(--red);text-shadow:0 0 20px var(--red);}
.next-key-hint{font-size:.82rem;color:#90caf9;min-height:22px;text-align:center;}
.finger-tag{display:inline-block;padding:2px 10px;border-radius:20px;font-weight:700;font-size:.78rem;}
.keyboard-wrap{width:100%;background:rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.07);border-radius:14px;padding:14px 12px 12px;overflow-x:auto;}
.keyboard{display:flex;flex-direction:column;gap:6px;min-width:600px;}
.kb-row{display:flex;gap:6px;}
.key{height:52px;min-width:52px;border-radius:9px;border:2px solid rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;font-size:1rem;font-weight:800;color:rgba(255,255,255,.4);background:rgba(255,255,255,.04);transition:all .08s;cursor:default;flex-shrink:0;position:relative;box-shadow:0 3px 0 rgba(0,0,0,.4);}
.key.fp{background:rgba(255,107,107,.18);border-color:rgba(255,107,107,.45);color:var(--fp);box-shadow:0 3px 0 rgba(255,107,107,.2);}
.key.fr{background:rgba(255,169,77,.18);border-color:rgba(255,169,77,.45);color:var(--fr);box-shadow:0 3px 0 rgba(255,169,77,.2);}
.key.fm{background:rgba(105,219,124,.18);border-color:rgba(105,219,124,.45);color:var(--fm);box-shadow:0 3px 0 rgba(105,219,124,.2);}
.key.fi{background:rgba(77,171,247,.18);border-color:rgba(77,171,247,.45);color:var(--fi);box-shadow:0 3px 0 rgba(77,171,247,.2);}
.key.ft{background:rgba(218,119,242,.18);border-color:rgba(218,119,242,.45);color:var(--ft);box-shadow:0 3px 0 rgba(218,119,242,.2);}
.key.home-key::after{content:'';position:absolute;bottom:5px;left:50%;transform:translateX(-50%);width:7px;height:3px;border-radius:2px;background:currentColor;opacity:.8;}
.key.active-key{transform:scale(1.18) translateY(-2px);box-shadow:0 0 22px currentColor,0 0 8px currentColor;color:white!important;z-index:2;}
.key.pressed{transform:scale(.88) translateY(3px);box-shadow:none;opacity:.6;}
.key.space-key{flex:1;min-width:200px;font-size:.8rem;color:rgba(255,255,255,.3);}
.score-popup{position:fixed;pointer-events:none;z-index:300;font-family:'M PLUS Rounded 1c',sans-serif;font-weight:800;font-size:1.3rem;color:var(--yellow);text-shadow:0 0 10px var(--yellow);animation:scorefly .9s ease-out forwards;white-space:nowrap;}
@keyframes scorefly{0%{transform:translateY(0) scale(1);opacity:1;}100%{transform:translateY(-70px) scale(.7);opacity:0;}}
.particle{position:fixed;pointer-events:none;z-index:200;border-radius:50%;animation:fly var(--dur,.7s) ease-out forwards;}
@keyframes fly{0%{transform:translate(0,0) scale(1);opacity:1;}100%{transform:translate(var(--tx),var(--ty)) scale(0);opacity:0;}}

/* ãƒ©ãƒ³ã‚­ãƒ³ã‚° */
#ranking-screen .panel{background:var(--panel);border:1px solid rgba(0,229,255,.2);border-radius:20px;padding:28px;width:100%;max-width:480px;text-align:center;}
#ranking-screen h2{font-family:'Kaisei Decol',serif;font-size:1.9rem;color:var(--accent2);text-shadow:0 0 20px var(--accent2);margin-bottom:4px;}
.final-score-big{font-size:3rem;font-weight:800;color:var(--green);text-shadow:0 0 30px var(--green);margin:8px 0 4px;}
.final-stats{font-size:.85rem;color:#90caf9;margin-bottom:16px;}
.name-area{display:flex;gap:8px;justify-content:center;margin-bottom:16px;flex-wrap:wrap;}
.name-area input{background:var(--panel2);border:2px solid rgba(0,229,255,.35);border-radius:10px;padding:9px 14px;font-family:'M PLUS Rounded 1c',sans-serif;font-size:1rem;color:white;width:180px;outline:none;}
.name-area input:focus{border-color:var(--accent);}
.rank-list{margin:0 0 16px;}
.rank-item{display:grid;grid-template-columns:30px 24px 1fr auto auto;align-items:center;gap:8px;padding:9px 12px;border-radius:9px;margin-bottom:5px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);font-size:.9rem;}
.rank-item.me{background:rgba(0,229,255,.09);border-color:rgba(0,229,255,.4);}
.rank-num{font-size:.95rem;font-weight:800;color:var(--accent2);}
.rank-medal{font-size:1.2rem;}
.rank-name{text-align:left;font-weight:700;}
.rank-score{font-weight:800;color:var(--green);white-space:nowrap;}
.rank-acc{font-size:.75rem;color:#90caf9;white-space:nowrap;}
.btn-row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;}

/* ã‚¬ã‚¤ãƒ‰ */
#guide-screen .panel{background:var(--panel);border:1px solid rgba(0,229,255,.2);border-radius:20px;padding:28px;width:100%;max-width:660px;}
#guide-screen h2{font-family:'Kaisei Decol',serif;font-size:1.7rem;color:var(--accent);text-shadow:0 0 20px var(--accent);margin-bottom:16px;text-align:center;}
.guide-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;}
.guide-card{background:var(--panel2);border-radius:10px;padding:12px;border:1px solid rgba(255,255,255,.05);}
.guide-card h3{font-size:.85rem;margin-bottom:6px;}
.guide-card p{font-size:.78rem;color:#90caf9;line-height:1.6;}
.hand-diagram{display:flex;gap:24px;justify-content:center;margin:14px 0;}
.hand{display:flex;flex-direction:column;align-items:center;gap:4px;}
.hand-label{font-size:.72rem;color:#90caf9;}
.fingers{display:flex;gap:3px;}
.finger{width:26px;height:56px;border-radius:13px 13px 7px 7px;display:flex;align-items:flex-end;justify-content:center;padding-bottom:3px;font-size:.58rem;font-weight:700;color:rgba(0,0,0,.75);}
.thumb{width:22px;height:32px;border-radius:7px;margin-top:24px;}
</style>
</head>
<body>
<div id="stars"></div>

<!-- ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ -->
<div id="license-screen" class="screen">
  <div class="license-box">
    <div class="license-icon">ğŸ”‘</div>
    <h2>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼</h2>
    <p>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
    <input type="password" id="license-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" maxlength="32" autocomplete="off">
    <div id="license-error" class="license-error"></div>
    <button class="btn" onclick="checkLicense()">èªè¨¼ã™ã‚‹</button>
  </div>
</div>

<!-- ã‚¿ã‚¤ãƒˆãƒ« -->
<div id="title-screen" class="screen hidden">
  <h1>ğŸ‰ ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼<br>ã‚¿ã‚¤ãƒ”ãƒ³ã‚°å¤§ä½œæˆ¦ï¼</h1>
  <p>ã‚„ã£ã¦ãã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’æ­£ã—ã„æŒ‡ã§ãŸãŠã›ï¼</p>
  <div class="rules-box">
    <h3>âš¡ ãƒ«ãƒ¼ãƒ«</h3>
    <div class="rule-item">â±ï¸ åˆ¶é™æ™‚é–“ã¯ <strong style="color:var(--accent2)">60ç§’</strong></div>
    <div class="rule-item">âŒ ãƒŸã‚¹ã‚¿ã‚¤ãƒ—ã™ã‚‹ã¨ <strong style="color:var(--red)">ï¼2ç§’</strong> ãƒšãƒŠãƒ«ãƒ†ã‚£ï¼</div>
    <div class="rule-item">ğŸ¯ æ­£ã—ã„æŒ‡ã§ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’ãŸãŠãã†ï¼</div>
    <div class="rule-item">ğŸ† ã‚¹ã‚³ã‚¢ã¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«æ®‹ã‚‹ã‚ˆï¼</div>
  </div>
  <div class="finger-legend">
    <div class="legend-item"><div class="legend-dot" style="background:var(--fp)"></div>å°æŒ‡</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--fr)"></div>è–¬æŒ‡</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--fm)"></div>ä¸­æŒ‡</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--fi)"></div>äººå·®ã—æŒ‡</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--ft)"></div>ãŠã‚„ã‚†ã³</div>
  </div>
  <div class="category-select">
    <h3>ğŸ“‚ ã‚«ãƒ†ã‚´ãƒªã‚’ãˆã‚‰ã¼ã†ï¼</h3>
    <div class="cat-grid" id="cat-grid"></div>
  </div>
  <button class="btn" onclick="startGame()">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
  <button class="btn btn-sub" onclick="showGuide()" style="margin-top:10px">ğŸ“– ãƒ›ãƒ¼ãƒ ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰</button>
</div>

<!-- ã‚¬ã‚¤ãƒ‰ -->
<div id="guide-screen" class="screen hidden">
  <div class="panel">
    <h2>ğŸ–ï¸ ãƒ›ãƒ¼ãƒ ãƒã‚¸ã‚·ãƒ§ãƒ³ã¨ã¯ï¼Ÿ</h2>
    <p style="text-align:center;color:#90caf9;margin-bottom:12px;font-size:.88rem">ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã®ã¨ãã€æŒ‡ã‚’ã„ã¤ã‚‚ã“ã“ã«ã‚‚ã©ã™ã‚ˆï¼</p>
    <div class="hand-diagram">
      <div class="hand">
        <div class="fingers">
          <div class="finger" style="background:var(--fp)">å°</div>
          <div class="finger" style="background:var(--fr)">è–¬</div>
          <div class="finger" style="background:var(--fm)">ä¸­</div>
          <div class="finger" style="background:var(--fi)">äºº</div>
          <div class="thumb finger" style="background:var(--ft)">è¦ª</div>
        </div>
        <div class="hand-label">ã²ã ã‚Šæ‰‹ï¼šA S D F</div>
      </div>
      <div class="hand">
        <div class="fingers">
          <div class="thumb finger" style="background:var(--ft)">è¦ª</div>
          <div class="finger" style="background:var(--fi)">äºº</div>
          <div class="finger" style="background:var(--fm)">ä¸­</div>
          <div class="finger" style="background:var(--fr)">è–¬</div>
          <div class="finger" style="background:var(--fp)">å°</div>
        </div>
        <div class="hand-label">ã¿ãæ‰‹ï¼šJ K L ï¼›</div>
      </div>
    </div>
    <div class="guide-grid">
      <div class="guide-card"><h3 style="color:var(--fp)">ğŸ©· å°æŒ‡</h3><p>å·¦ï¼šAãƒ»Qãƒ»Z<br>å³ï¼šï¼›ãƒ»Pãƒ»ï¼</p></div>
      <div class="guide-card"><h3 style="color:var(--fr)">ğŸ§¡ è–¬æŒ‡</h3><p>å·¦ï¼šSãƒ»Wãƒ»X<br>å³ï¼šLãƒ»Oãƒ».</p></div>
      <div class="guide-card"><h3 style="color:var(--fm)">ğŸ’š ä¸­æŒ‡</h3><p>å·¦ï¼šDãƒ»Eãƒ»C<br>å³ï¼šKãƒ»Iãƒ»,</p></div>
      <div class="guide-card"><h3 style="color:var(--fi)">ğŸ’™ äººå·®ã—æŒ‡</h3><p>å·¦ï¼šFãƒ»Gãƒ»Rãƒ»Tãƒ»Vãƒ»B<br>å³ï¼šJãƒ»Hãƒ»Uãƒ»Yãƒ»Mãƒ»N</p></div>
    </div>
    <p style="text-align:center;color:#b0bec5;font-size:.78rem;margin-bottom:14px">âš¡ Fã‚­ãƒ¼ã¨Jã‚­ãƒ¼ã«ã¯å°ã•ãªã§ã£ã±ã‚ŠãŒã‚ã‚‹ã‚ˆï¼</p>
    <div style="text-align:center"><button class="btn" onclick="showScreen('title-screen')">ã‚‚ã©ã‚‹</button></div>
  </div>
</div>

<!-- ã‚²ãƒ¼ãƒ  -->
<div id="game-screen" class="screen hidden">
  <div class="game-header">
    <div class="hud-item"><div class="hud-label">ãŸãŠã—ãŸæ•°</div><div class="hud-value" id="kill-value">0</div></div>
    <div class="hud-item"><div class="hud-label">ã‚¹ã‚³ã‚¢</div><div class="hud-value" id="score-value">0</div></div>
    <div class="hud-item"><div class="hud-label">ã›ã„ã‹ã„ã‚Šã¤</div><div class="hud-value" id="acc-value">100%</div></div>
    <div class="hud-item">
      <div class="hud-label">ã‚³ãƒ³ãƒœ</div>
      <div id="combo-wrap">
        <div class="hud-value" id="combo-value">0</div>
        <div id="combo-reset-flash">ãƒªã‚»ãƒƒãƒˆï¼</div>
      </div>
    </div>
    <div class="hud-item">
      <div class="hud-label">ã®ã“ã‚Šæ™‚é–“</div>
      <div id="timer-wrap">
        <div class="hud-value" id="timer-value">60</div>
        <div id="penalty-flash">ï¼2ç§’ï¼</div>
      </div>
    </div>
  </div>
  <div class="game-area">
    <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progress-bar" style="width:100%"></div></div>
    <div class="monster-stage" id="monster-stage">
      <div id="word-bubble">ï¼Ÿ</div>
      <div id="monster">ğŸ‰</div>
    </div>
    <div class="input-section">
      <div class="input-display" id="input-display"></div>
      <div class="romaji-guide" id="romaji-guide"></div>
      <div class="feedback-msg" id="feedback-msg"></div>
      <div class="next-key-hint" id="next-key-hint"></div>
    </div>
    <div class="keyboard-wrap"><div class="keyboard" id="keyboard"></div></div>
  </div>
</div>

<!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚° -->
<div id="ranking-screen" class="screen hidden">
  <div class="panel">
    <h2>ğŸ† ã‚²ãƒ¼ãƒ çµ‚äº†ï¼</h2>
    <div class="final-score-big" id="final-score">0pt</div>
    <div class="final-stats" id="final-stats"></div>
    <div class="name-area" id="name-area">
      <input type="text" id="player-name" placeholder="ãªã¾ãˆã‚’å…¥ã‚Œã¦ã­" maxlength="8">
      <button class="btn" style="padding:9px 20px;font-size:.95rem" onclick="saveRanking()">ç™»éŒ²ï¼</button>
    </div>
    <div class="rank-list" id="rank-list"></div>
    <div class="btn-row">
      <button class="btn" onclick="startGame()">ã‚‚ã†ä¸€å›ï¼</button>
      <button class="btn btn-sub" onclick="showTitle()">ã‚¿ã‚¤ãƒˆãƒ«ã¸</button>
    </div>
  </div>
</div>

<script>
// ===== ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ =====
const LICENSE_KEY = 'MONSTER2025'; // â˜…å¤‰æ›´å¯â˜…
let licenseOk = false;

function checkLicense() {
  const val = document.getElementById('license-input').value.trim().toUpperCase();
  if (val === LICENSE_KEY.toUpperCase()) {
    licenseOk = true;
    document.getElementById('license-error').textContent = '';
    showScreen('title-screen');
  } else {
    document.getElementById('license-error').textContent = 'âŒ ã‚­ãƒ¼ãŒé•ã„ã¾ã™ã€‚ã‚‚ã†ä¸€åº¦ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
    document.getElementById('license-input').value = '';
    document.getElementById('license-input').focus();
  }
}
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('license-input').addEventListener('keydown', e => {
    if (e.key === 'Enter') checkLicense();
  });
});

// ===== ç”»é¢åˆ‡æ›¿ =====
function showScreen(id) {
  ['license-screen','title-screen','guide-screen','game-screen','ranking-screen']
    .forEach(s => document.getElementById(s).classList.toggle('hidden', s !== id));
}
function showTitle() { stopGame(); showScreen(licenseOk ? 'title-screen' : 'license-screen'); }
function showGuide() { showScreen('guide-screen'); }

// ===== å®šæ•° =====
const TOTAL_TIME = 60;
const PENALTY_SEC = 2;
const WALK_MS = 10000;
const MONSTERS = ['ğŸ‰','ğŸ‘¾','ğŸ§Ÿ','ğŸ¦–','ğŸ‘¹','ğŸ²','ğŸ¤–','ğŸ‘»','ğŸ¦•','ğŸ˜ˆ','ğŸ§Œ','ğŸŠ'  {word:'ã˜ã—ã‚‡',romaji:'zisyo',hint:'ğŸ“–è¾æ›¸',cat:'school'},
  {word:'ã‘ã‚“ã³ãã‚‡ã†',romaji:'kennbikyou',hint:'ğŸ”¬é¡•å¾®é¡',cat:'school'},
  {word:'ãã‚…ã†ã—ã‚‡ã',romaji:'kyuusyoku',hint:'ğŸ±çµ¦é£Ÿ',cat:'school'},
  {word:'ãã†ã˜',romaji:'souzi',hint:'ğŸ§¹æƒé™¤',cat:'school'},
  {word:'ã«ã£ã¡ã‚‡ã',romaji:'nittyoku',hint:'æ—¥ç›´',cat:'school'},
  {word:'ã†ã‚“ã©ã†ã‹ã„',romaji:'unndoukai',hint:'ğŸƒé‹å‹•ä¼š',cat:'school'},
  {word:'ãŒãã’ã„ã‹ã„',romaji:'gakugeikai',hint:'å­¦èŠ¸ä¼š',cat:'school'},
  {word:'ã—ã‚…ã†ãŒãã‚Šã‚‡ã“ã†',romaji:'syuugakuryokou',hint:'âœˆï¸ä¿®å­¦æ—…è¡Œ',cat:'school'},
  {word:'ãˆã‚“ãã',romaji:'ennsoku',hint:'ğŸ’é è¶³',cat:'school'},
  {word:'ã«ã‚…ã†ãŒãã—ã',romaji:'nyuugakusiki',hint:'å…¥å­¦å¼',cat:'school'},
  {word:'ãã¤ãã‚‡ã†ã—ã',romaji:'sotugyousiki',hint:'å’æ¥­å¼',cat:'school'},
  {word:'ã‚Šã‹ã—ã¤',romaji:'rikasitu',hint:'ç†ç§‘å®¤',cat:'school'},
  {word:'ãšã“ã†ã—ã¤',romaji:'zukousitu',hint:'å›³å·¥å®¤',cat:'school'},
  {word:'ãŠã‚“ãŒãã—ã¤',romaji:'onngakusitu',hint:'ğŸµéŸ³æ¥½å®¤',cat:'school'},
  {word:'ã—ã‚‡ãã„ã‚“ã—ã¤',romaji:'syokuinnsitu',hint:'è·å“¡å®¤',cat:'school'},
  {word:'ã»ã‘ã‚“ã—ã¤',romaji:'hokennsitu',hint:'ğŸ¥ä¿å¥å®¤',cat:'school'},
  {word:'ã“ã†ã¦ã„',romaji:'koutei',hint:'æ ¡åº­',cat:'school'},
  {word:'ã™ã„ã¡ã‚‡ã',romaji:'suityoku',hint:'å‚ç›´',cat:'school'},
  {word:'ã¸ã„ã“ã†',romaji:'heikou',hint:'å¹³è¡Œ',cat:'school'},
  {word:'ã•ã‚“ã‹ãã‘ã„',romaji:'sannkakukei',hint:'â–³ä¸‰è§’å½¢',cat:'school'},
  {word:'ã—ã‹ãã‘ã„',romaji:'sikakukei',hint:'â–¡å››è§’å½¢',cat:'school'},
  {word:'ãˆã‚“ã—ã‚…ã†ã‚Šã¤',romaji:'ennsyuuritu',hint:'å††å‘¨ç‡',cat:'school'},
  {word:'ã¶ã‚“ã™ã†',romaji:'bunnsuu',hint:'åˆ†æ•°',cat:'school'},
  {word:'ã—ã‚‡ã†ã™ã†',romaji:'syousuu',hint:'å°æ•°',cat:'school'},
  {word:'ã“ãã”',romaji:'kokugo',hint:'ğŸ“–å›½èª',cat:'school'},
  {word:'ã•ã‚“ã™ã†',romaji:'sannsuu',hint:'â•ç®—æ•°',cat:'school'},
  {word:'ã‚Šã‹',romaji:'rika',hint:'ğŸ”¬ç†ç§‘',cat:'school'},
  {word:'ã—ã‚ƒã‹ã„',romaji:'syakai',hint:'ğŸŒç¤¾ä¼š',cat:'school'},
  {word:'ãŸã„ã„ã',romaji:'taiiku',hint:'ğŸƒä½“è‚²',cat:'school'},
  {word:'ã‹ã„ã ã‚“',romaji:'kaidann',hint:'éšæ®µ',cat:'school'},
  {word:'ã—ã‚“ãŸã„ããã¦ã„',romaji:'sinntaisokutei',hint:'èº«ä½“æ¸¬å®š',cat:'school'},
  {word:'ã‹ã‹ã‚Šã‹ã¤ã©ã†',romaji:'kakarikatudou',hint:'ä¿‚æ´»å‹•',cat:'school'},
  {word:'ãŸã‚“ã„',romaji:'tanni',hint:'å˜ä½',cat:'school'},
  {word:'ã«ã‚…ã†ãŒã',romaji:'nyuugaku',hint:'å…¥å­¦',cat:'school'},
  {word:'ãã¤ãã‚‡ã†',romaji:'sotugyou',hint:'å’æ¥­',cat:'school'},
];

const WORDS = [
  // words
  {word:'ã†ã¿',romaji:'umi',hint:'æµ·',cat:'words'},
  {word:'ãã‚‰',romaji:'sora',hint:'ç©º',cat:'words'},
  {word:'ã»ã—',romaji:'hosi',hint:'æ˜Ÿ',cat:'words'},
  {word:'ã¤ã',romaji:'tuki',hint:'æœˆ',cat:'words'},
  {word:'ã¯ãª',romaji:'hana',hint:'èŠ±',cat:'words'},
  {word:'ã‹ãœ',romaji:'kaze',hint:'é¢¨',cat:'words'},
  {word:'ã‚†ã',romaji:'yuki',hint:'é›ª',cat:'words'},
  {word:'ãã‚‚',romaji:'kumo',hint:'é›²',cat:'words'},
  {word:'ã‹ã‚',romaji:'kawa',hint:'å·',cat:'words'},
  {word:'ã‚‚ã‚Š',romaji:'mori',hint:'æ£®',cat:'words'},
  {word:'ã‚„ã¾',romaji:'yama',hint:'å±±',cat:'words'},
  {word:'ã¿ãš',romaji:'mizu',hint:'æ°´',cat:'words'},
  {word:'ã²ã‹ã‚Š',romaji:'hikari',hint:'å…‰',cat:'words'},
  {word:'ã«ã˜',romaji:'nizi',hint:'è™¹',cat:'words'},
  {word:'ã„ãªãšã¾',romaji:'inazuma',hint:'ç¨²å¦»',cat:'words'},
  {word:'ãŸã„ã‚ˆã†',romaji:'taiyou',hint:'å¤ªé™½',cat:'words'},
  {word:'ã¡ãã‚…ã†',romaji:'tikyuu',hint:'åœ°çƒ',cat:'words'},
  {word:'ã†ã¡ã‚…ã†',romaji:'utyuu',hint:'å®‡å®™',cat:'words'},
  {word:'ãƒ­ã‚±ãƒƒãƒˆ',romaji:'roketto',hint:'å®‡å®™èˆ¹',cat:'words'},
  {word:'ã›ã„ã–',romaji:'seiza',hint:'æ˜Ÿåº§',cat:'words'},
  {word:'ãã‚“ãŒ',romaji:'ginnga',hint:'éŠ€æ²³',cat:'words'},
  {word:'ãŸã‚“ã‘ã‚“',romaji:'tannkenn',hint:'æ¢æ¤œ',cat:'words'},
  {word:'ã¼ã†ã‘ã‚“',romaji:'boukenn',hint:'å†’é™º',cat:'words'},
  {word:'ã‹ãŒã',romaji:'kagaku',hint:'ç§‘å­¦',cat:'words'},
  {word:'ã§ã‚“ã',romaji:'dennki',hint:'é›»æ°—',cat:'words'},
  {word:'ã²ã“ã†ã',romaji:'hikouki',hint:'é£›è¡Œæ©Ÿ',cat:'words'},
  {word:'ã—ã‚“ã‹ã‚“ã›ã‚“',romaji:'sinnkannsenn',hint:'æ–°å¹¹ç·š',cat:'words'},
  {word:'ã©ã†ã¶ã¤',romaji:'doubutu',hint:'å‹•ç‰©',cat:'words'},
  {word:'ã—ãœã‚“',romaji:'sizenn',hint:'è‡ªç„¶',cat:'words'},
  {word:'ãŸã„ã‘ã‚“',romaji:'taikenn',hint:'ä½“é¨“',cat:'words'},
  {word:'ãã›ã¤',romaji:'kisetu',hint:'å­£ç¯€',cat:'words'},
  {word:'ã‚€ã‹ã—',romaji:'mukasi',hint:'ã‚€ã‹ã—è©±',cat:'words'},
  {word:'ã‚‚ã®ãŒãŸã‚Š',romaji:'monogatari',hint:'ç‰©èª',cat:'words'},
  {word:'ã˜ã£ã‘ã‚“',romaji:'zikkenn',hint:'å®Ÿé¨“',cat:'words'},
  {word:'ã¯ã£ã‘ã‚“',romaji:'hakkenn',hint:'ç™ºè¦‹',cat:'words'},
  {word:'ã‹ã‚“ã•ã¤',romaji:'kannsatu',hint:'è¦³å¯Ÿ',cat:'words'},
  {word:'ãã†ãã†',romaji:'souzou',hint:'æƒ³åƒ',cat:'words'},
  {word:'ãã‚‡ã†ã¿',romaji:'kyoumi',hint:'èˆˆå‘³',cat:'words'},
  {word:'ã—ã‚“ã‹',romaji:'sinnka',hint:'é€²åŒ–',cat:'words'},
  {word:'ã¡ãã‚…ã†ã',romaji:'tikyuugi',hint:'åœ°çƒå„€',cat:'words'},
  {word:'ãŸã„ã‚Šã',romaji:'tairiku',hint:'å¤§é™¸',cat:'words'},
  {word:'ã‹ã„ã‚ˆã†',romaji:'kaiyou',hint:'æµ·æ´‹',cat:'words'},
  {word:'ãã“ã†',romaji:'kikou',hint:'æ°—å€™',cat:'words'},
  {word:'ã‹ã‚“ãã‚‡ã†',romaji:'kannkyou',hint:'ç’°å¢ƒ',cat:'words'},
  {word:'ã—ã’ã‚“',romaji:'sigenn',hint:'è³‡æº',cat:'words'},
  {word:'ãˆã­ã‚‹ããƒ¼',romaji:'enerugi-',hint:'ã‚¨ãƒãƒ«ã‚®ãƒ¼',cat:'words'},
  {word:'ã¶ã‚“ã‚ã„',romaji:'bunnmei',hint:'æ–‡æ˜',cat:'words'},
  {word:'ã‚Œãã—',romaji:'rekisi',hint:'æ­´å²',cat:'words'},
  {word:'ã¶ã‚“ã‹',romaji:'bunnka',hint:'æ–‡åŒ–',cat:'words'},
  {word:'ã§ã‚“ã¨ã†',romaji:'denntou',hint:'ä¼çµ±',cat:'words'},
  // animals
  {word:'ã„ã¬',romaji:'inu',hint:'ğŸ•çŠ¬',cat:'animals'},
  {word:'ã­ã“',romaji:'neko',hint:'ğŸˆçŒ«',cat:'animals'},
  {word:'ã†ã•ã',romaji:'usagi',hint:'ğŸ°ã†ã•ã',cat:'animals'},
  {word:'ãã¾',romaji:'kuma',hint:'ğŸ»ç†Š',cat:'animals'},
  {word:'ã¨ã‚‰',romaji:'tora',hint:'ğŸ¯è™',cat:'animals'},
  {word:'ãã†',romaji:'zou',hint:'ğŸ˜è±¡',cat:'animals'},
  {word:'ãã‚Šã‚“',romaji:'kirinn',hint:'ğŸ¦’ã‚­ãƒªãƒ³',cat:'animals'},
  {word:'ãºã‚“ãã‚“',romaji:'pennginn',hint:'ğŸ§ãƒšãƒ³ã‚®ãƒ³',cat:'animals'},
  {word:'ã”ã‚Šã‚‰',romaji:'gorira',hint:'ğŸ¦ã‚´ãƒªãƒ©',cat:'animals'},
  {word:'ã‚‰ã„ãŠã‚“',romaji:'raionn',hint:'ğŸ¦ãƒ©ã‚¤ã‚ªãƒ³',cat:'animals'},
  {word:'ã•ã‚‹',romaji:'saru',hint:'ğŸ’ã‚µãƒ«',cat:'animals'},
  {word:'ãã¤ã­',romaji:'kitune',hint:'ğŸ¦Šã‚­ãƒ„ãƒ',cat:'animals'},
  {word:'ãŠãŠã‹ã¿',romaji:'ookami',hint:'ğŸºã‚ªã‚ªã‚«ãƒŸ',cat:'animals'},
  {word:'ã‹ã°',romaji:'kaba',hint:'ğŸ¦›ã‚«ãƒ',cat:'animals'},
  {word:'ã‹ã‚“ãŒã‚‹ãƒ¼',romaji:'kanngaru-',hint:'ğŸ¦˜ã‚«ãƒ³ã‚¬ãƒ«ãƒ¼',cat:'animals'},
  {word:'ã±ã‚“ã ',romaji:'pannda',hint:'ğŸ¼ãƒ‘ãƒ³ãƒ€',cat:'animals'},
  {word:'ã„ã‚‹ã‹',romaji:'iruka',hint:'ğŸ¬ã‚¤ãƒ«ã‚«',cat:'animals'},
  {word:'ãã˜ã‚‰',romaji:'kuzira',hint:'ğŸ‹ã‚¯ã‚¸ãƒ©',cat:'animals'},
  {word:'ã•ã‹ãª',romaji:'sakana',hint:'ğŸŸã•ã‹ãª',cat:'animals'},
  {word:'ã‹ã‚',romaji:'kame',hint:'ğŸ¢ã‚«ãƒ¡',cat:'animals'},
  {word:'ã‚ã«',romaji:'wani',hint:'ğŸŠãƒ¯ãƒ‹',cat:'animals'},
  {word:'ã‹ãˆã‚‹',romaji:'kaeru',hint:'ğŸ¸ã‚«ã‚¨ãƒ«',cat:'animals'},
  {word:'ã¡ã‚‡ã†ã¡ã‚‡ã†',romaji:'tyoutyou',hint:'ğŸ¦‹ãƒãƒ§ã‚¦',cat:'animals'},
  {word:'ã¿ã¤ã°ã¡',romaji:'mitubati',hint:'ğŸãƒŸãƒ„ãƒãƒ',cat:'animals'},
  {word:'ãµãã‚ã†',romaji:'hukurou',hint:'ğŸ¦‰ãƒ•ã‚¯ãƒ­ã‚¦',cat:'animals'},
  {word:'ã¸ã³',romaji:'hebi',hint:'ğŸè›‡',cat:'animals'},
  {word:'ãŸã¬ã',romaji:'tanuki',hint:'ğŸ¦ã‚¿ãƒŒã‚­',cat:'animals'},
  {word:'ã—ã‹',romaji:'sika',hint:'ğŸ¦Œé¹¿',cat:'animals'},
  {word:'ã„ã®ã—ã—',romaji:'inosisi',hint:'ğŸ—ã‚¤ãƒã‚·ã‚·',cat:'animals'},
  {word:'ã‚‚ãã‚‰',romaji:'mogura',hint:'ãƒ¢ã‚°ãƒ©',cat:'animals'},
  {word:'ã‚Šã™',romaji:'risu',hint:'ğŸ¿ï¸ãƒªã‚¹',cat:'animals'},
  {word:'ã¯ã‚€ã™ãŸãƒ¼',romaji:'hamusuta-',hint:'ğŸ¹ãƒãƒ ã‚¹ã‚¿ãƒ¼',cat:'animals'},
  {word:'ã“ã†ã‚‚ã‚Š',romaji:'koumori',hint:'ğŸ¦‡ã‚³ã‚¦ãƒ¢ãƒª',cat:'animals'},
  {word:'ãƒ•ãƒ©ãƒŸãƒ³ã‚´',romaji:'huraminngo',hint:'ğŸ¦©ãƒ•ãƒ©ãƒŸãƒ³ã‚´',cat:'animals'},
  {word:'ãã¤ã¤ã',romaji:'kitutuki',hint:'ã‚­ãƒ„ãƒ„ã‚­',cat:'animals'},
  {word:'ã¤ã°ã‚',romaji:'tubame',hint:'ğŸ¦ãƒ„ãƒãƒ¡',cat:'animals'},
  {word:'ã¯ã¨',romaji:'hato',hint:'ğŸ•Šï¸ãƒãƒˆ',cat:'animals'},
  {word:'ã‹ã‚‰ã™',romaji:'karasu',hint:'ã‚«ãƒ©ã‚¹',cat:'animals'},
  {word:'ã‚ã—',romaji:'wasi',hint:'ğŸ¦…ãƒ¯ã‚·',cat:'animals'},
  {word:'ãŸã‹',romaji:'taka',hint:'ğŸ¦…ã‚¿ã‚«',cat:'animals'},
  {word:'ãŸã“',romaji:'tako',hint:'ğŸ™ã‚¿ã‚³',cat:'animals'},
  {word:'ã„ã‹',romaji:'ika',hint:'ğŸ¦‘ã‚¤ã‚«',cat:'animals'},
  {word:'ãˆã³',romaji:'ebi',hint:'ğŸ¦ã‚¨ãƒ“',cat:'animals'},
  {word:'ã‹ã«',romaji:'kani',hint:'ğŸ¦€ã‚«ãƒ‹',cat:'animals'},
  {word:'ãã‚‰ã’',romaji:'kurage',hint:'ğŸª¼ã‚¯ãƒ©ã‚²',cat:'animals'},
  {word:'ã²ã¨ã§',romaji:'hitode',hint:'ãƒ’ãƒˆãƒ‡',cat:'animals'},
  {word:'ã‚ã–ã‚‰ã—',romaji:'azarasi',hint:'ğŸ¦­ã‚¢ã‚¶ãƒ©ã‚·',cat:'animals'},
  {word:'ã›ã„ã†ã¡',romaji:'seiuti',hint:'ã‚»ã‚¤ã‚¦ãƒ',cat:'animals'},
  {word:'ã—ã‚ãã¾',romaji:'sirokuma',hint:'ğŸ»â€â„ï¸ã‚·ãƒ­ã‚¯ãƒ',cat:'animals'},
  {word:'ã“ã‚ã‚‰',romaji:'koara',hint:'ğŸ¨ã‚³ã‚¢ãƒ©',cat:'animals'},
  // food
  {word:'ã”ã¯ã‚“',romaji:'gohann',hint:'ğŸšã”ã¯ã‚“',cat:'food'},
  {word:'ã™ã—',romaji:'susi',hint:'ğŸ£ã™ã—',cat:'food'},
  {word:'ã†ã©ã‚“',romaji:'udonn',hint:'ã†ã©ã‚“',cat:'food'},
  {word:'ãã°',romaji:'soba',hint:'ãã°',cat:'food'},
  {word:'ã‚«ãƒ¬ãƒ¼',romaji:'kare-',hint:'ğŸ›ã‚«ãƒ¬ãƒ¼',cat:'food'},
  {word:'ãŠã«ãã‚Š',romaji:'onigiri',hint:'ğŸ™ãŠã«ãã‚Š',cat:'food'},
  {word:'ã‚Šã‚“ã”',romaji:'rinngo',hint:'ğŸã‚Šã‚“ã”',cat:'food'},
  {word:'ãƒãƒŠãƒŠ',romaji:'banana',hint:'ğŸŒãƒãƒŠãƒŠ',cat:'food'},
  {word:'ã„ã¡ã”',romaji:'itigo',hint:'ğŸ“ã„ã¡ã”',cat:'food'},
  {word:'ã™ã„ã‹',romaji:'suika',hint:'ğŸ‰ã™ã„ã‹',cat:'food'},
  {word:'ã¿ã‹ã‚“',romaji:'mikann',hint:'ğŸŠã¿ã‹ã‚“',cat:'food'},
  {word:'ã¶ã©ã†',romaji:'budou',hint:'ğŸ‡ã¶ã©ã†',cat:'food'},
  {word:'ã‚±ãƒ¼ã‚­',romaji:'ke-ki',hint:'ğŸ°ã‚±ãƒ¼ã‚­',cat:'food'},
  {word:'ã‚¢ã‚¤ã‚¹',romaji:'aisu',hint:'ğŸ¦ã‚¢ã‚¤ã‚¹',cat:'food'},
  {word:'ãƒ—ãƒªãƒ³',romaji:'purinn',hint:'ğŸ®ãƒ—ãƒªãƒ³',cat:'food'},
  {word:'ãƒãƒ§ã‚³',romaji:'tyoko',hint:'ğŸ«ãƒãƒ§ã‚³',cat:'food'},
  {word:'ã¨ã¾ã¨',romaji:'tomato',hint:'ğŸ…ãƒˆãƒãƒˆ',cat:'food'},
  {word:'ã«ã‚“ã˜ã‚“',romaji:'ninnzinn',hint:'ğŸ¥•ã«ã‚“ã˜ã‚“',cat:'food'},
  {word:'ãŸã¾ã”',romaji:'tamago',hint:'ğŸ¥šãŸã¾ã”',cat:'food'},
  {word:'ãƒ”ã‚¶',romaji:'piza',hint:'ğŸ•ãƒ”ã‚¶',cat:'food'},
  {word:'ã¿ãã—ã‚‹',romaji:'misosiru',hint:'ğŸœå‘³å™Œæ±',cat:'food'},
  {word:'ã¦ã‚“ã·ã‚‰',romaji:'tennpura',hint:'å¤©ã·ã‚‰',cat:'food'},
  {word:'ã‚„ãã¨ã‚Š',romaji:'yakitori',hint:'ğŸ—ç„¼ãé³¥',cat:'food'},
  {word:'ãƒ©ãƒ¼ãƒ¡ãƒ³',romaji:'ra-menn',hint:'ğŸœãƒ©ãƒ¼ãƒ¡ãƒ³',cat:'food'},
  {word:'ãã‚‡ã†ã–',romaji:'gyouza',hint:'ğŸ¥Ÿé¤ƒå­',cat:'food'},
  {word:'ã‚„ããã°',romaji:'yakisoba',hint:'ğŸç„¼ããã°',cat:'food'},
  {word:'ãŠã“ã®ã¿ã‚„ã',romaji:'okonomiyaki',hint:'ãŠå¥½ã¿ç„¼ã',cat:'food'},
  {word:'ãŸã“ã‚„ã',romaji:'takoyaki',hint:'ğŸ™ãŸã“ç„¼ã',cat:'food'},
  {word:'ãªã£ã¨ã†',romaji:'nattou',hint:'ç´è±†',cat:'food'},
  {word:'ã¨ã†ãµ',romaji:'touhu',hint:'è±†è…',cat:'food'},
  {word:'ãˆã ã¾ã‚',romaji:'edamame',hint:'æè±†',cat:'food'},
  {word:'ã‚‚ã‚„ã—',romaji:'moyasi',hint:'ã‚‚ã‚„ã—',cat:'food'},
  {word:'ã»ã†ã‚Œã‚“ãã†',romaji:'hourennsou',hint:'ã»ã†ã‚Œã‚“è‰',cat:'food'},
  {word:'ã‹ã¼ã¡ã‚ƒ',romaji:'kabotya',hint:'ğŸƒã‹ã¼ã¡ã‚ƒ',cat:'food'},
  {word:'ã•ã¤ã¾ã„ã‚‚',romaji:'satumaimo',hint:'ã•ã¤ã¾ã„ã‚‚',cat:'food'},
  {word:'ã˜ã‚ƒãŒã„ã‚‚',romaji:'zyagaimo',hint:'ã˜ã‚ƒãŒã„ã‚‚',cat:'food'},
  {word:'ãã‚…ã†ã‚Š',romaji:'kyuuri',hint:'ğŸ¥’ãã‚…ã†ã‚Š',cat:'food'},
  {word:'ãªã™',romaji:'nasu',hint:'ğŸ†ãªã™',cat:'food'},
  {word:'ã­ã',romaji:'negi',hint:'ã­ã',cat:'food'},
  {word:'ãƒãƒ¼ã‚º',romaji:'ti-zu',hint:'ğŸ§€ãƒãƒ¼ã‚º',cat:'food'},
  {word:'ãƒ¨ãƒ¼ã‚°ãƒ«ãƒˆ',romaji:'yo-guruto',hint:'ãƒ¨ãƒ¼ã‚°ãƒ«ãƒˆ',cat:'food'},
  {word:'ãƒã‚¿ãƒ¼',romaji:'bata-',hint:'ãƒã‚¿ãƒ¼',cat:'food'},
  {word:'ã‚¸ãƒ¥ãƒ¼ã‚¹',romaji:'zyu-su',hint:'ğŸ§ƒã‚¸ãƒ¥ãƒ¼ã‚¹',cat:'food'},
  {word:'ã‚³ãƒ¼ãƒ’ãƒ¼',romaji:'ko-hi-',hint:'â˜•ã‚³ãƒ¼ãƒ’ãƒ¼',cat:'food'},
  {word:'ãŠã¡ã‚ƒ',romaji:'otya',hint:'ğŸµãŠèŒ¶',cat:'food'},
  {word:'ã‚‚ã‚‚',romaji:'momo',hint:'ğŸ‘ã‚‚ã‚‚',cat:'food'},
  {word:'ãªã—',romaji:'nasi',hint:'ğŸãªã—',cat:'food'},
  {word:'ã‹ã',romaji:'kaki',hint:'ğŸ«ã‹ã',cat:'food'},
  {word:'ãƒ¡ãƒ­ãƒ³',romaji:'meronn',hint:'ğŸˆãƒ¡ãƒ­ãƒ³',cat:'food'},
  {word:'ã„ã¡ã˜ã',romaji:'itiziku',hint:'ã„ã¡ã˜ã',cat:'food'},
  // prefectures
  {word:'ã»ã£ã‹ã„ã©ã†',romaji:'hokkaidou',hint:'åŒ—æµ·é“',cat:'prefectures'},
  {word:'ã¨ã†ãã‚‡ã†',romaji:'toukyou',hint:'æ±äº¬éƒ½',cat:'prefectures'},
  {word:'ãŠãŠã•ã‹',romaji:'oosaka',hint:'å¤§é˜ªåºœ',cat:'prefectures'},
  {word:'ãã‚‡ã†ã¨',romaji:'kyouto',hint:'äº¬éƒ½åºœ',cat:'prefectures'},
  {word:'ã‚ã„ã¡',romaji:'aiti',hint:'æ„›çŸ¥çœŒ',cat:'prefectures'},
  {word:'ã‹ãªãŒã‚',romaji:'kanagawa',hint:'ç¥å¥ˆå·çœŒ',cat:'prefectures'},
  {word:'ã•ã„ãŸã¾',romaji:'saitama',hint:'åŸ¼ç‰çœŒ',cat:'prefectures'},
  {word:'ã¡ã°',romaji:'tiba',hint:'åƒè‘‰çœŒ',cat:'prefectures'},
  {word:'ãªãŒã®',romaji:'nagano',hint:'é•·é‡çœŒ',cat:'prefectures'},
  {word:'ã«ã„ãŒãŸ',romaji:'niigata',hint:'æ–°æ½ŸçœŒ',cat:'prefectures'},
  {word:'ã¿ã‚„ã',romaji:'miyagi',hint:'å®®åŸçœŒ',cat:'prefectures'},
  {word:'ã²ã‚ã—ã¾',romaji:'hirosima',hint:'åºƒå³¶çœŒ',cat:'prefectures'},
  {word:'ãµããŠã‹',romaji:'hukuoka',hint:'ç¦å²¡çœŒ',cat:'prefectures'},
  {word:'ãŠããªã‚',romaji:'okinawa',hint:'æ²–ç¸„çœŒ',cat:'prefectures'},
  {word:'ã‚ãŠã‚‚ã‚Š',romaji:'aomori',hint:'é’æ£®çœŒ',cat:'prefectures'},
  {word:'ã„ã‚ã¦',romaji:'iwate',hint:'å²©æ‰‹çœŒ',cat:'prefectures'},
  {word:'ã‚ããŸ',romaji:'akita',hint:'ç§‹ç”°çœŒ',cat:'prefectures'},
  {word:'ã‚„ã¾ãŒãŸ',romaji:'yamagata',hint:'å±±å½¢çœŒ',cat:'prefectures'},
  {word:'ãµãã—ã¾',romaji:'hukusima',hint:'ç¦å³¶çœŒ',cat:'prefectures'},
  {word:'ãªã‚‰',romaji:'nara',hint:'å¥ˆè‰¯çœŒ',cat:'prefectures'},
  {word:'ã¨ã¡ã',romaji:'totigi',hint:'æ ƒæœ¨çœŒ',cat:'prefectures'},
  {word:'ãã‚“ã¾',romaji:'gunnma',hint:'ç¾¤é¦¬çœŒ',cat:'prefectures'},
  {word:'ã„ã°ã‚‰ã',romaji:'ibaraki',hint:'èŒ¨åŸçœŒ',cat:'prefectures'},
  {word:'ã‚„ã¾ãªã—',romaji:'yamanasi',hint:'å±±æ¢¨çœŒ',cat:'prefectures'},
  {word:'ã—ãšãŠã‹',romaji:'sizuoka',hint:'é™å²¡çœŒ',cat:'prefectures'},
  {word:'ã¿ãˆ',romaji:'mie',hint:'ä¸‰é‡çœŒ',cat:'prefectures'},
  {word:'ã—ãŒ',romaji:'siga',hint:'æ»‹è³€çœŒ',cat:'prefectures'},
  {word:'ã²ã‚‡ã†ã”',romaji:'hyougo',hint:'å…µåº«çœŒ',cat:'prefectures'},
  {word:'ã‚ã‹ã‚„ã¾',romaji:'wakayama',hint:'å’Œæ­Œå±±çœŒ',cat:'prefectures'},
  {word:'ã¨ã£ã¨ã‚Š',romaji:'tottori',hint:'é³¥å–çœŒ',cat:'prefectures'},
  {word:'ã—ã¾ã­',romaji:'simane',hint:'å³¶æ ¹çœŒ',cat:'prefectures'},
  {word:'ãŠã‹ã‚„ã¾',romaji:'okayama',hint:'å²¡å±±çœŒ',cat:'prefectures'},
  {word:'ã‚„ã¾ãã¡',romaji:'yamaguti',hint:'å±±å£çœŒ',cat:'prefectures'},
  {word:'ã¨ãã—ã¾',romaji:'tokusima',hint:'å¾³å³¶çœŒ',cat:'prefectures'},
  {word:'ã‹ãŒã‚',romaji:'kagawa',hint:'é¦™å·çœŒ',cat:'prefectures'},
  {word:'ãˆã²ã‚',romaji:'ehime',hint:'æ„›åª›çœŒ',cat:'prefectures'},
  {word:'ã“ã†ã¡',romaji:'kouti',hint:'é«˜çŸ¥çœŒ',cat:'prefectures'},
  {word:'ã•ãŒ',romaji:'saga',hint:'ä½è³€çœŒ',cat:'prefectures'},
  {word:'ãªãŒã•ã',romaji:'nagasaki',hint:'é•·å´çœŒ',cat:'prefectures'},
  {word:'ãã¾ã‚‚ã¨',romaji:'kumamoto',hint:'ç†Šæœ¬çœŒ',cat:'prefectures'},
  {word:'ãŠãŠã„ãŸ',romaji:'ooita',hint:'å¤§åˆ†çœŒ',cat:'prefectures'},
  {word:'ã¿ã‚„ã–ã',romaji:'miyazaki',hint:'å®®å´çœŒ',cat:'prefectures'},
  {word:'ã‹ã”ã—ã¾',romaji:'kagosima',hint:'é¹¿å…å³¶çœŒ',cat:'prefectures'},
  {word:'ã„ã—ã‹ã‚',romaji:'isikawa',hint:'çŸ³å·çœŒ',cat:'prefectures'},
  {word:'ããµ',romaji:'gihu',hint:'å²é˜œçœŒ',cat:'prefectures'},
  {word:'ã¨ã‚„ã¾',romaji:'toyama',hint:'å¯Œå±±çœŒ',cat:'prefectures'},
  {word:'ãµãã„',romaji:'hukui',hint:'ç¦äº•çœŒ',cat:'prefectures'},
  // english
  {word:'apple',romaji:'apple',hint:'ğŸã‚Šã‚“ã”',cat:'english'},
  {word:'banana',romaji:'banana',hint:'ğŸŒãƒãƒŠãƒŠ',cat:'english'},
  {word:'orange',romaji:'orange',hint:'ğŸŠã‚ªãƒ¬ãƒ³ã‚¸',cat:'english'},
  {word:'school',romaji:'school',hint:'ğŸ«å­¦æ ¡',cat:'english'},
  {word:'book',romaji:'book',hint:'ğŸ“šæœ¬',cat:'english'},
  {word:'cat',romaji:'cat',hint:'ğŸˆã­ã“',cat:'english'},
  {word:'dog',romaji:'dog',hint:'ğŸ•ã„ã¬',cat:'english'},
  {word:'sun',romaji:'sun',hint:'â˜€ï¸ãŸã„ã‚ˆã†',cat:'english'},
  {word:'moon',romaji:'moon',hint:'ğŸŒ™ã¤ã',cat:'english'},
  {word:'star',romaji:'star',hint:'â­ã»ã—',cat:'english'},
  {word:'water',romaji:'water',hint:'ğŸ’§ã¿ãš',cat:'english'},
  {word:'fire',romaji:'fire',hint:'ğŸ”¥ã²',cat:'english'},
  {word:'flower',romaji:'flower',hint:'ğŸŒ¸ã¯ãª',cat:'english'},
  {word:'happy',romaji:'happy',hint:'ğŸ˜Šã—ã‚ã‚ã›',cat:'english'},
  {word:'friend',romaji:'friend',hint:'ğŸ‘«ã¨ã‚‚ã ã¡',cat:'english'},
  {word:'music',romaji:'music',hint:'ğŸµãŠã‚“ãŒã',cat:'english'},
  {word:'dream',romaji:'dream',hint:'ğŸ’­ã‚†ã‚',cat:'english'},
  {word:'heart',romaji:'heart',hint:'â¤ï¸ã“ã“ã‚',cat:'english'},
  {word:'smile',romaji:'smile',hint:'ğŸ˜ŠãˆãŒãŠ',cat:'english'},
  {word:'love',romaji:'love',hint:'â¤ï¸ã‚ã„',cat:'english'},
  {word:'animal',romaji:'animal',hint:'å‹•ç‰©',cat:'english'},
  {word:'nature',romaji:'nature',hint:'è‡ªç„¶',cat:'english'},
  {word:'science',romaji:'science',hint:'ç§‘å­¦',cat:'english'},
  {word:'earth',romaji:'earth',hint:'åœ°çƒ',cat:'english'},
  {word:'space',romaji:'space',hint:'å®‡å®™',cat:'english'},
  {word:'ocean',romaji:'ocean',hint:'æµ·',cat:'english'},
  {word:'mountain',romaji:'mountain',hint:'å±±',cat:'english'},
  {word:'forest',romaji:'forest',hint:'æ£®',cat:'english'},
  {word:'river',romaji:'river',hint:'å·',cat:'english'},
  {word:'cloud',romaji:'cloud',hint:'é›²',cat:'english'},
  {word:'light',romaji:'light',hint:'å…‰',cat:'english'},
  {word:'night',romaji:'night',hint:'å¤œ',cat:'english'},
  {word:'world',romaji:'world',hint:'ä¸–ç•Œ',cat:'english'},
  {word:'country',romaji:'country',hint:'å›½',cat:'english'},
  {word:'people',romaji:'people',hint:'äººã€…',cat:'english'},
  {word:'family',romaji:'family',hint:'å®¶æ—',cat:'english'},
  {word:'future',romaji:'future',hint:'æœªæ¥',cat:'english'},
  {word:'history',romaji:'history',hint:'æ­´å²',cat:'english'},
  {word:'culture',romaji:'culture',hint:'æ–‡åŒ–',cat:'english'},
  {word:'language',romaji:'language',hint:'è¨€èª',cat:'english'},
  {word:'problem',romaji:'problem',hint:'å•é¡Œ',cat:'english'},
  {word:'answer',romaji:'answer',hint:'ç­”ãˆ',cat:'english'},
  {word:'question',romaji:'question',hint:'è³ªå•',cat:'english'},
  {word:'strong',romaji:'strong',hint:'å¼·ã„',cat:'english'},
  {word:'brave',romaji:'brave',hint:'å‹‡æ•¢',cat:'english'},
  {word:'gentle',romaji:'gentle',hint:'ã‚„ã•ã—ã„',cat:'english'},
  {word:'wonder',romaji:'wonder',hint:'ä¸æ€è­°',cat:'english'},
  {word:'create',romaji:'create',hint:'å‰µã‚‹',cat:'english'},
  {word:'discover',romaji:'discover',hint:'ç™ºè¦‹ã™ã‚‹',cat:'english'},
  {word:'journey',romaji:'journey',hint:'æ—…',cat:'english'},
  // sports
  {word:'ã‚µãƒƒã‚«ãƒ¼',romaji:'sakka-',hint:'âš½ã‚µãƒƒã‚«ãƒ¼',cat:'sports'},
  {word:'ã‚„ãã‚…ã†',romaji:'yakyuu',hint:'âš¾é‡çƒ',cat:'sports'},
  {word:'ãƒã‚¹ã‚±ãƒƒãƒˆ',romaji:'basuketto',hint:'ğŸ€ãƒã‚¹ã‚±',cat:'sports'},
  {word:'ãƒ†ãƒ‹ã‚¹',romaji:'tenisu',hint:'ğŸ¾ãƒ†ãƒ‹ã‚¹',cat:'sports'},
  {word:'ã™ã„ãˆã„',romaji:'suiei',hint:'ğŸŠæ°´æ³³',cat:'sports'},
  {word:'ãŸã„ãã†',romaji:'taisou',hint:'ğŸ¤¸ä½“æ“',cat:'sports'},
  {word:'ã˜ã‚…ã†ã©ã†',romaji:'zyuudou',hint:'ğŸ¥‹æŸ”é“',cat:'sports'},
  {word:'ã‚¹ã‚­ãƒ¼',romaji:'suki-',hint:'â›·ï¸ã‚¹ã‚­ãƒ¼',cat:'sports'},
  {word:'ã‚¹ã‚±ãƒ¼ãƒˆ',romaji:'suke-to',hint:'â›¸ï¸ã‚¹ã‚±ãƒ¼ãƒˆ',cat:'sports'},
  {word:'ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°',romaji:'rannninngu',hint:'ğŸƒãƒ©ãƒ³ãƒ‹ãƒ³ã‚°',cat:'sports'},
  {word:'ãŸã£ãã‚…ã†',romaji:'takkyuu',hint:'ğŸ“å“çƒ',cat:'sports'},
  {word:'ã‚´ãƒ«ãƒ•',romaji:'goruhu',hint:'â›³ã‚´ãƒ«ãƒ•',cat:'sports'},
  {word:'ãƒãƒ©ã‚½ãƒ³',romaji:'marasonn',hint:'ğŸƒãƒãƒ©ã‚½ãƒ³',cat:'sports'},
  {word:'ãªã‚ã¨ã³',romaji:'nawatobi',hint:'ãªã‚ã¨ã³',cat:'sports'},
  {word:'ãƒãƒ¬ãƒ¼ãƒœãƒ¼ãƒ«',romaji:'bare-bo-ru',hint:'ğŸãƒãƒ¬ãƒ¼ãƒœãƒ¼ãƒ«',cat:'sports'},
  {word:'ãƒ©ã‚°ãƒ“ãƒ¼',romaji:'ragubi-',hint:'ğŸ‰ãƒ©ã‚°ãƒ“ãƒ¼',cat:'sports'},
  {word:'ãƒœã‚¯ã‚·ãƒ³ã‚°',romaji:'bokusinngu',hint:'ğŸ¥Šãƒœã‚¯ã‚·ãƒ³ã‚°',cat:'sports'},
  {word:'ãƒ¬ã‚¹ãƒªãƒ³ã‚°',romaji:'resurinngu',hint:'ğŸ¤¼ãƒ¬ã‚¹ãƒªãƒ³ã‚°',cat:'sports'},
  {word:'ã‘ã‚“ã©ã†',romaji:'kenndou',hint:'âš”ï¸å‰£é“',cat:'sports'},
  {word:'ã‹ã‚‰ã¦',romaji:'karate',hint:'ğŸ¥‹ç©ºæ‰‹',cat:'sports'},
  {word:'ãã‚…ã†ã©ã†',romaji:'kyuudou',hint:'ğŸ¹å¼“é“',cat:'sports'},
  {word:'ã™ã‚‚ã†',romaji:'sumou',hint:'ğŸ‹ï¸ç›¸æ’²',cat:'sports'},
  {word:'ãã‚‡ã†ãã†',romaji:'kyousou',hint:'ğŸƒç«¶èµ°',cat:'sports'},
  {word:'ã˜ã¦ã‚“ã—ã‚ƒ',romaji:'zitennsya',hint:'ğŸš´è‡ªè»¢è»Š',cat:'sports'},
  {word:'ã‚¹ã‚±ãƒ¼ãƒˆãƒœãƒ¼ãƒ‰',romaji:'suke-tobo-do',hint:'ğŸ›¹ã‚¹ã‚±ãƒ¼ãƒˆãƒœãƒ¼ãƒ‰',cat:'sports'},
  {word:'ã‚µãƒ¼ãƒ•ã‚£ãƒ³',romaji:'sa-huinn',hint:'ğŸ„ã‚µãƒ¼ãƒ•ã‚£ãƒ³',cat:'sports'},
  {word:'ãƒã‚¤ã‚­ãƒ³ã‚°',romaji:'haikinngu',hint:'ğŸ¥¾ãƒã‚¤ã‚­ãƒ³ã‚°',cat:'sports'},
  {word:'ã‚­ãƒ£ãƒ³ãƒ—',romaji:'kyannpu',hint:'â›ºã‚­ãƒ£ãƒ³ãƒ—',cat:'sports'},
  {word:'ã¤ã‚Š',romaji:'turi',hint:'ğŸ£é‡£ã‚Š',cat:'sports'},
  {word:'ã‚„ã¾ã®ã¼ã‚Š',romaji:'yamanobori',hint:'ğŸ§—å±±ç™»ã‚Š',cat:'sports'},
  {word:'ãƒ€ãƒ³ã‚¹',romaji:'dannsu',hint:'ğŸ’ƒãƒ€ãƒ³ã‚¹',cat:'sports'},
  {word:'ãƒ•ã‚§ãƒ³ã‚·ãƒ³ã‚°',romaji:'huennsinngu',hint:'ğŸ¤ºãƒ•ã‚§ãƒ³ã‚·ãƒ³ã‚°',cat:'sports'},
  {word:'ãƒ›ãƒƒã‚±ãƒ¼',romaji:'hokke-',hint:'ğŸ’ãƒ›ãƒƒã‚±ãƒ¼',cat:'sports'},
  {word:'ã‚¯ãƒªã‚±ãƒƒãƒˆ',romaji:'kuriketto',hint:'ğŸã‚¯ãƒªã‚±ãƒƒãƒˆ',cat:'sports'},
  {word:'ã‚»ãƒ¼ãƒªãƒ³ã‚°',romaji:'se-rinngu',hint:'â›µã‚»ãƒ¼ãƒªãƒ³ã‚°',cat:'sports'},
  {word:'ã‚«ãƒŒãƒ¼',romaji:'kanu-',hint:'ğŸ›¶ã‚«ãƒŒãƒ¼',cat:'sports'},
  {word:'ãƒœãƒ¼ãƒˆ',romaji:'bo-to',hint:'ğŸš£ãƒœãƒ¼ãƒˆ',cat:'sports'},
  {word:'ãƒˆãƒ©ã‚¤ã‚¢ã‚¹ãƒ­ãƒ³',romaji:'toraiasuronn',hint:'ãƒˆãƒ©ã‚¤ã‚¢ã‚¹ãƒ­ãƒ³',cat:'sports'},
  {word:'ãƒšã‚¿ãƒ³ã‚¯',romaji:'petannku',hint:'ãƒšã‚¿ãƒ³ã‚¯',cat:'sports'},
  {word:'ãƒ“ãƒªãƒ¤ãƒ¼ãƒ‰',romaji:'biriya-do',hint:'ğŸ±ãƒ“ãƒªãƒ¤ãƒ¼ãƒ‰',cat:'sports'},
  {word:'ã—ã‚‡ã†ã',romaji:'syougi',hint:'â™Ÿï¸å°†æ£‹',cat:'sports'},
  {word:'ã„ã”',romaji:'igo',hint:'å›²ç¢',cat:'sports'},
  {word:'ã‹ã‚‹ãŸ',romaji:'karuta',hint:'ğŸƒã‹ã‚‹ãŸ',cat:'sports'},
  {word:'ãƒã‚§ã‚¹',romaji:'chesu',hint:'â™Ÿï¸ãƒã‚§ã‚¹',cat:'sports'},
  {word:'ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³',romaji:'badominntonn',hint:'ğŸ¸ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³',cat:'sports'},
  {word:'ã‚¢ãƒ¼ãƒã‚§ãƒªãƒ¼',romaji:'a-cheri-',hint:'ğŸ¹ã‚¢ãƒ¼ãƒã‚§ãƒªãƒ¼',cat:'sports'},
  {word:'ã¡ã‚‡ã†ã‚„ã',romaji:'tyouyaku',hint:'è·³èº',cat:'sports'},
  {word:'ãã‚…ã†ãã',romaji:'kyuusoku',hint:'ä¼‘æ¯',cat:'sports'},
  {word:'ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°',romaji:'wo-kinngu',hint:'ğŸš¶ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°',cat:'sports'},
  {word:'ã‚¸ãƒ§ã‚®ãƒ³ã‚°',romaji:'zyoginngu',hint:'ğŸƒã‚¸ãƒ§ã‚®ãƒ³ã‚°',cat:'sports'},
  // proverbs
  {word:'ã„ããŒã°ã¾ã‚ã‚Œ',romaji:'isogabamaware',hint:'æ€¥ãã¨ãã»ã©å®‰å…¨ãªé“ã‚’',cat:'proverbs'},
  {word:'ã•ã‚‹ã‚‚ãã‹ã‚‰ãŠã¡ã‚‹',romaji:'sarumokikaraotiru',hint:'åäººã§ã‚‚å¤±æ•—ã™ã‚‹',cat:'proverbs'},
  {word:'ã“ã‚ã°ã¬ã•ãã®ã¤ãˆ',romaji:'korobanusakinotue',hint:'å‰ã‚‚ã£ã¦æº–å‚™ã—ã‚ˆã†',cat:'proverbs'},
  {word:'ãŸãªã‹ã‚‰ã¼ãŸã‚‚ã¡',romaji:'tanakarabotamoti',hint:'æ€ã‚ã¬å¹¸é‹ãŒæ¥ã‚‹',cat:'proverbs'},
  {word:'ã—ã£ã±ã„ã¯ã›ã„ã“ã†ã®ã‚‚ã¨',romaji:'sippaihaseikounomoto',hint:'å¤±æ•—ã‹ã‚‰å­¦ã‚“ã§æˆåŠŸã¸',cat:'proverbs'},
  {word:'ã‘ã„ããã¯ã¡ã‹ã‚‰ãªã‚Š',romaji:'keizokuhatikaranari',hint:'ç¶šã‘ã‚‹ã“ã¨ãŒåŠ›ã«ãªã‚‹',cat:'proverbs'},
  {word:'ã„ã—ã®ã†ãˆã«ã‚‚ã•ã‚“ã­ã‚“',romaji:'isinouenimosannnenn',hint:'æˆ‘æ…¢å¼·ãç¶šã‘ã‚Œã°æˆåŠŸã™ã‚‹',cat:'proverbs'},
  {word:'ã§ã‚‹ãã„ã¯ã†ãŸã‚Œã‚‹',romaji:'derukuihautareru',hint:'ç›®ç«‹ã¤äººã¯æ‰¹åˆ¤ã•ã‚Œã‚„ã™ã„',cat:'proverbs'},
  {word:'ã¡ã‚Šã‚‚ã¤ã‚‚ã‚Œã°ã‚„ã¾ã¨ãªã‚‹',romaji:'tirimotumorebayamatonaru',hint:'å°ã•ãªã“ã¨ã‚‚ç©ã¿é‡ãªã‚Œã°å¤§ãããªã‚‹',cat:'proverbs'},
  {word:'ãã¡ã¯ã‚ã–ã‚ã„ã®ã‚‚ã¨',romaji:'kutihawazawainomoto',hint:'è»½ç‡ãªç™ºè¨€ã¯ç½ã„ã‚’æ‹›ã',cat:'proverbs'},
  {word:'ãªã›ã°ãªã‚‹',romaji:'nasebanaru',hint:'ç‚ºã›ã°æˆã‚‹',cat:'proverbs'},
  {word:'ã¿ã®ã»ã©ã‚’ã—ã‚Œ',romaji:'minohodowosire',hint:'èº«ã®ç¨‹ã‚’çŸ¥ã‚Œ',cat:'proverbs'},
  {word:'ã‚‹ã„ã¯ã¨ã‚‚ã‚’ã‚ˆã¶',romaji:'ruihatomowoyobu',hint:'é¡ã¯å‹ã‚’å‘¼ã¶',cat:'proverbs'},
  {word:'ã¯ãªã‚ˆã‚Šã ã‚“ã”',romaji:'hanayoridanngo',hint:'èŠ±ã‚ˆã‚Šå›£å­',cat:'proverbs'},
  {word:'ã©ã‚“ãã‚Šã®ã›ã„ãã‚‰ã¹',romaji:'donngurinoseikurabe',hint:'ã©ã‚“ãã‚Šã®èƒŒæ¯”ã¹',cat:'proverbs'},
  {word:'ãŸã§ãã†ã‚€ã—ã‚‚ã™ããšã',romaji:'tadekuumusimosukizuki',hint:'è“¼é£Ÿã†è™«ã‚‚å¥½ãå¥½ã',cat:'proverbs'},
  {word:'ã˜ã‚…ã†ã«ã‚“ã¨ã„ã‚',romaji:'zyuuninntoiro',hint:'åäººåè‰²',cat:'proverbs'},
  {word:'ã‚ãŸã¾ã‹ãã—ã¦ã—ã‚Šã‹ãã•ãš',romaji:'atamakakusitesirikakusazu',hint:'é ­éš ã—ã¦å°»éš ã•ãš',cat:'proverbs'},
  {word:'ã‹ã‚ã„ã„ã“ã«ã¯ãŸã³ã‚’ã•ã›ã‚ˆ',romaji:'kawaiikonihatabiwosaseyo',hint:'å¯æ„›ã„å­ã«ã¯æ—…ã‚’ã•ã›ã‚ˆ',cat:'proverbs'},
  {word:'ã¾ã‘ã‚‹ãŒã‹ã¡',romaji:'makerugakati',hint:'è² ã‘ã‚‹ãŒå‹ã¡',cat:'proverbs'},
  {word:'ã†ãã‚‚ã»ã†ã¹ã‚“',romaji:'usomohoubenn',hint:'å˜˜ã‚‚æ–¹ä¾¿',cat:'proverbs'},
  {word:'ã²ã¨ã®ãµã‚Šã¿ã¦ã‚ãŒãµã‚ŠãªãŠã›',romaji:'hitonohurimitewagahurinaose',hint:'äººã®æŒ¯ã‚Šè¦‹ã¦æˆ‘ãŒæŒ¯ã‚Šç›´ã›',cat:'proverbs'},
  {word:'ã®ã©ã‚‚ã¨ã™ãã‚Œã°ã‚ã¤ã•ã‚’ã‚ã™ã‚Œã‚‹',romaji:'nodomotosugirebaatusawowasureru',hint:'å–‰å…ƒéãã‚Œã°ç†±ã•ã‚’å¿˜ã‚Œã‚‹',cat:'proverbs'},
  {word:'ã‚ã¨ã¯ã®ã¨ãªã‚Œã‚„ã¾ã¨ãªã‚Œ',romaji:'atohanotonareyamatonare',hint:'å¾Œã¯é‡ã¨ãªã‚Œå±±ã¨ãªã‚Œ',cat:'proverbs'},
  {word:'ãŠã«ã‚‚ã˜ã‚…ã†ã¯ã¡ã°ã‚“ã¡ã‚ƒã‚‚ã§ã°ãª',romaji:'onimozyuuhatibanntyamodebana',hint:'é¬¼ã‚‚åå…«ç•ªèŒ¶ã‚‚å‡ºèŠ±',cat:'proverbs'},
  // school
  {word:'ãˆã‚“ã´ã¤',romaji:'ennpitu',hint:'âœï¸ãˆã‚“ã´ã¤',cat:'school'},
  {word:'ã‘ã—ã”ã‚€',romaji:'kesigomu',hint:'æ¶ˆã—ã‚´ãƒ ',cat:'school'},
  {word:'ã‚‚ã®ã•ã—',romaji:'monosasi',hint:'ğŸ“ã‚‚ã®ã•ã—',cat:'school'},
  {word:'ã¯ã•ã¿',romaji:'hasami',hint:'âœ‚ï¸ã¯ã•ã¿',cat:'school'},
  {word:'ãƒ©ãƒ³ãƒ‰ã‚»ãƒ«',romaji:'ranndoseru',hint:'ğŸ’ãƒ©ãƒ³ãƒ‰ã‚»ãƒ«',cat:'school'},
  {word:'ãã‚‡ã†ã‹ã—ã‚‡',romaji:'kyoukasyo',hint:'ğŸ“–æ•™ç§‘æ›¸',cat:'school'},
  {word:'ãƒãƒ¼ãƒˆ',romaji:'no-to',hint:'ğŸ““ãƒãƒ¼ãƒˆ',cat:'school'},
  {word:'ã‚¯ãƒ¬ãƒ¨ãƒ³',romaji:'kureyonn',hint:'ğŸ–ï¸ã‚¯ãƒ¬ãƒ¨ãƒ³',cat:'school'},
  {word:'ã¤ããˆ',romaji:'tukue',hint:'æœº',cat:'school'},
  {word:'ã“ãã°ã‚“',romaji:'kokubann',hint:'é»’æ¿',cat:'school'},
  {word:'ã¨ã—ã‚‡ã‹ã‚“',romaji:'tosyokann',hint:'ğŸ“šå›³æ›¸é¤¨',cat:'school'},
  {word:'ãã‚‡ã†ã—ã¤',romaji:'kyousitu',hint:'æ•™å®¤',cat:'school'},
  {word:'ãŸã„ã„ãã‹ã‚“',romaji:'taiikukann',hint:'ğŸƒä½“è‚²é¤¨',cat:'school'},
  {word:'ã›ã‚“ã›ã„',romaji:'sennsei',hint:'ğŸ‘¨â€ğŸ«å…ˆç”Ÿ',cat:'school'},
  {word:'ãµã§ã°ã“',romaji:'hudebako',hint:'ç­†ç®±',cat:'school'},
];

const KEY_FINGER = {
  '1':'fp','2':'fr','3':'fm','4':'fi','5':'fi','6':'fi','7':'fi','8':'fm','9':'fr','0':'fp',
  '-':'fp','^':'fp','\\':'fp',
  'q':'fp','w':'fr','e':'fm','r':'fi','t':'fi','y':'fi','u':'fi','i':'fm','o':'fr','p':'fp','@':'fp',
  'a':'fp','s':'fr','d':'fm','f':'fi','g':'fi','h':'fi','j':'fi','k':'fm','l':'fr',';':'fp',':':'fp',
  'z':'fp','x':'fr','c':'fm','v':'fi','b':'fi','n':'fi','m':'fi',',':'fm','.':'fr','/':'fp',
  ' ':'ft',
};
const FINGER_NAMES = {'fp':'å°æŒ‡','fr':'è–¬æŒ‡','fm':'ä¸­æŒ‡','fi':'äººå·®ã—æŒ‡','ft':'ãŠã‚„ã‚†ã³'};
const FINGER_COLORS = {'fp':'var(--fp)','fr':'var(--fr)','fm':'var(--fm)','fi':'var(--fi)','ft':'var(--ft)'};
const HOME_KEYS = ['a','s','d','f','j','k','l',';'];
const KB_ROWS = [
  ['1','2','3','4','5','6','7','8','9','0','-','^'],
  ['q','w','e','r','t','y','u','i','o','p','@'],
  ['a','s','d','f','g','h','j','k','l',';',':'],
  ['z','x','c','v','b','n','m',',','.','/'],
  ['space'],
];
const CATEGORIES = [
  {id:'all',label:'ğŸ² å…¨éƒ¨ã¾ãœã¾ãœ'},{id:'animals',label:'ğŸ¾ å‹•ç‰©'},
  {id:'food',label:'ğŸš é£Ÿã¹ç‰©'},{id:'prefectures',label:'ğŸ—¾ éƒ½é“åºœçœŒ'},
  {id:'english',label:'ğŸ”¤ è‹±å˜èª'},{id:'words',label:'ğŸ“š ã„ã‚ã„ã‚ãªè¨€è‘‰'},
  {id:'sports',label:'ğŸƒ ã‚¹ãƒãƒ¼ãƒ„'},{id:'proverbs',label:'ğŸ“– ã“ã¨ã‚ã–'},
  {id:'school',label:'ğŸ’ å­¦æ ¡ãƒ»æ–‡æˆ¿å…·'},
];

// ===== ãƒ­ãƒ¼ãƒå­—ã‚†ã‚Œå±•é–‹ =====
const ALT_PAIRS = [
  ['shi','si'],['chi','ti'],['tsu','tu'],['ji','zi'],['fu','hu'],
  ['sha','sya'],['shu','syu'],['sho','syo'],
  ['cha','tya'],['chu','tyu'],['cho','tyo'],
  ['cya','tya'],['cyu','tyu'],['cyo','tyo'],
  ['ja','zya'],['jya','zya'],['ju','zyu'],['jyu','zyu'],
  ['jo','zyo'],['jyo','zyo'],
];
function expandRomaji(rom) {
  let variants = new Set([rom]);
  let changed = true;
  while (changed) {
    changed = false;
    for (const v of [...variants]) {
      for (const [a, b] of ALT_PAIRS) {
        for (const [src, dst] of [[a,b],[b,a]]) {
          let idx = v.indexOf(src);
          while (idx !== -1) {
            const nv = v.slice(0,idx) + dst + v.slice(idx+src.length);
            if (!variants.has(nv)) { variants.add(nv); changed = true; }
            idx = v.indexOf(src, idx+1);
          }
        }
      }
    }
  }
  // nnâ†’nå±•é–‹
  for (const v of [...variants]) {
    for (let i = 0; i < v.length-1; i++) {
      if (v[i]==='n' && v[i+1]==='n') {
        const next = v[i+2];
        if (!next || !'aiueony'.includes(next)) {
          variants.add(v.slice(0,i)+'n'+v.slice(i+2));
        }
      }
    }
  }
  return [...variants];
}

// ===== ã‚²ãƒ¼ãƒ çŠ¶æ…‹ =====
let score=0, kills=0, totalTyped=0, correctTyped=0;
let timerSec=TOTAL_TIME, timerInterval=null, gameActive=false;
let currentWord=null, wordPool=[], wordIdx=0;
let monsterRafId=null, monsterStartTime=0;
let combo=0, wordStarted=false, wordStartTime=0;
let lastSavedScore=null, feedbackTimer=null;
let selectedCategory='all';
let typedBuf='', currentVariants=[];

// ===== åˆæœŸåŒ– =====
function initStars() {
  const c = document.getElementById('stars');
  for (let i=0; i<120; i++) {
    const s = document.createElement('div');
    s.className = 'star';
    const sz = Math.random()*2.5+0.5;
    s.style.cssText = `width:${sz}px;height:${sz}px;left:${Math.random()*100}%;top:${Math.random()*100}%;--d:${(Math.random()*3+1).toFixed(1)}s;--dl:${(Math.random()*4).toFixed(1)}s;opacity:${(Math.random()*.5+.1).toFixed(2)}`;
    c.appendChild(s);
  }
}

function buildKeyboard() {
  const kb = document.getElementById('keyboard');
  KB_ROWS.forEach(row => {
    const rowEl = document.createElement('div');
    rowEl.className = 'kb-row';
    row.forEach(k => {
      const el = document.createElement('div');
      if (k === 'space') {
        el.className = 'key space-key ft';
        el.textContent = 'ã‚¹ãƒšãƒ¼ã‚¹';
        el.id = 'key-space';
      } else {
        const fc = KEY_FINGER[k] || '';
        el.className = 'key' + (fc?' '+fc:'') + (HOME_KEYS.includes(k)?' home-key':'');
        el.textContent = k.toUpperCase();
        el.id = 'key-' + k;
      }
      rowEl.appendChild(el);
    });
    kb.appendChild(rowEl);
  });
}

function buildCategoryGrid() {
  const grid = document.getElementById('cat-grid');
  CATEGORIES.forEach(cat => {
    const btn = document.createElement('button');
    btn.className = 'cat-btn' + (cat.id === selectedCategory ? ' selected' : '');
    btn.textContent = cat.label;
    btn.id = 'cat-' + cat.id;
    btn.onclick = () => {
      selectedCategory = cat.id;
      document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
    };
    grid.appendChild(btn);
  });
}

// ===== ã‚²ãƒ¼ãƒ é–‹å§‹ =====
function startGame() {
  score=0; kills=0; totalTyped=0; correctTyped=0;
  timerSec=TOTAL_TIME; wordIdx=0; combo=0;
  wordStarted=false; gameActive=true; lastSavedScore=null;

  const src = selectedCategory==='all' ? WORDS : WORDS.filter(w=>w.cat===selectedCategory);
  const pool = src.length>0 ? src : WORDS;
  wordPool = shuffle([...pool]).concat(shuffle([...pool])).concat(shuffle([...pool]));

  document.getElementById('timer-value').classList.remove('danger');
  showScreen('game-screen');
  updateHUD();
  loadWord();
  startTimer();
}

function stopGame() {
  gameActive = false;
  clearInterval(timerInterval);
  cancelAnimationFrame(monsterRafId);
}

// ===== ã‚¿ã‚¤ãƒãƒ¼ =====
function startTimer() {
  clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    if (!gameActive) return;
    timerSec = Math.max(0, timerSec-1);
    updateTimerUI();
    if (timerSec <= 0) endGame();
  }, 1000);
}

function updateTimerUI() {
  const el = document.getElementById('timer-value');
  el.textContent = timerSec;
  el.classList.toggle('danger', timerSec<=10);
  const pct = timerSec/TOTAL_TIME;
  const pb = document.getElementById('progress-bar');
  pb.style.width = (pct*100)+'%';
  pb.style.background = pct>.4
    ? 'linear-gradient(90deg,var(--accent),var(--accent3))'
    : 'linear-gradient(90deg,#ff9800,var(--red))';
}

function applyPenalty() {
  timerSec = Math.max(0, timerSec-PENALTY_SEC);
  updateTimerUI();
  const pf = document.getElementById('penalty-flash');
  pf.classList.remove('show'); void pf.offsetWidth; pf.classList.add('show');
  if (timerSec<=0) endGame();
}

// ===== å˜èªãƒ­ãƒ¼ãƒ‰ =====
function loadWord() {
  if (!gameActive) return;
  if (wordIdx >= wordPool.length) {
    const src = selectedCategory==='all' ? WORDS : WORDS.filter(w=>w.cat===selectedCategory);
    wordPool = shuffle([...src]).concat(shuffle([...src]));
    wordIdx = 0;
  }
  currentWord = wordPool[wordIdx++];
  typedBuf = '';
  currentVariants = expandRomaji(currentWord.romaji);

  const monEl = document.getElementById('monster');
  const bubble = document.getElementById('word-bubble');
  const stage = document.getElementById('monster-stage');
  monEl.className = '';
  monEl.textContent = MONSTERS[Math.floor(Math.random()*MONSTERS.length)];
  bubble.textContent = currentWord.word + 'ï¼ˆ' + currentWord.hint + 'ï¼‰';
  bubble.style.opacity = '1';
  setMonsterPos(monEl, bubble, stage, 1.0);
  startMonsterWalk(stage, monEl, bubble);

  const disp = document.getElementById('input-display');
  disp.innerHTML = '';
  currentWord.romaji.split('').forEach((_,i) => {
    const b = document.createElement('div');
    b.className = 'char-box' + (i===0 ? ' cur' : '');
    b.id = 'cb-'+i;
    disp.appendChild(b);
  });

  wordStarted = false;
  updateRomajiGuide();
  highlightNextKey();
  clearFeedback();
}

// ===== ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚¢ãƒ‹ãƒ¡ =====
function startMonsterWalk(stage, monEl, bubble) {
  cancelAnimationFrame(monsterRafId);
  monsterStartTime = performance.now();
  function step(ts) {
    if (!gameActive) return;
    const ratio = 1.0 - (ts-monsterStartTime)/WALK_MS;
    if (ratio <= 0) { onMonsterReached(); return; }
    setMonsterPos(monEl, bubble, stage, ratio);
    monsterRafId = requestAnimationFrame(step);
  }
  monsterRafId = requestAnimationFrame(step);
}

function setMonsterPos(monEl, bubble, stage, ratio) {
  const p = 1.0 - ratio;
  const scale = 0.12 + 0.88*(p*p);
  const opacity = 0.15 + 0.85*p;
  const sh = stage.offsetHeight || 160;
  const bottomPx = 6 + (sh-70)*(1-p*p);
  monEl.style.setProperty('--ms', scale);
  monEl.style.setProperty('--mo', opacity);
  monEl.style.bottom = bottomPx+'px';
  bubble.style.bottom = (bottomPx + 5*16*scale + 8)+'px';
}

function onMonsterReached() {
  cancelAnimationFrame(monsterRafId);
  showFeedback('ğŸ’€ ã‚„ã‚‰ã‚ŒãŸï¼','ng');
  setTimeout(() => { if (gameActive) loadWord(); }, 700);
}

// ===== ã‚­ãƒ¼å…¥åŠ› =====
document.addEventListener('keydown', e => {
  if (!gameActive) return;
  if (e.key==='Tab'||e.key==='Enter') { e.preventDefault(); return; }
  const ch = e.key===' ' ? ' ' : e.key.toLowerCase();
  if (ch.length !== 1) return;

  // ã‚­ãƒ¼ã‚¢ãƒ‹ãƒ¡
  const kid = ch===' ' ? 'key-space' : 'key-'+ch;
  const kel = document.getElementById(kid);
  if (kel) { kel.classList.add('pressed'); setTimeout(()=>kel.classList.remove('pressed'),100); }

  totalTyped++;
  const attempt = typedBuf + ch;

  // ã„ãšã‚Œã‹ã®ãƒãƒªã‚¢ãƒ³ãƒˆã®prefixã‹ï¼Ÿ
  const isPrefix = currentVariants.some(v => v.startsWith(attempt));

  if (isPrefix) {
    if (!wordStarted) { wordStartTime = performance.now(); wordStarted = true; }
    correctTyped++;
    typedBuf = attempt;

    // æ–‡å­—ãƒœãƒƒã‚¯ã‚¹æ›´æ–°
    const boxIdx = typedBuf.length - 1;
    const cb = document.getElementById('cb-'+boxIdx);
    if (cb) { cb.textContent = ch.toUpperCase(); cb.className = 'char-box ok'; }
    // æ¬¡ã®ãƒœãƒƒã‚¯ã‚¹ã‚’curã«
    const ncb = document.getElementById('cb-'+typedBuf.length);
    if (ncb) { ncb.className = 'char-box cur'; }

    // å®Œäº†ãƒã‚§ãƒƒã‚¯
    if (currentVariants.some(v => v === typedBuf)) {
      onWordComplete(); return;
    }
    updateRomajiGuide();
    highlightNextKey();
  } else {
    // ãƒŸã‚¹
    const boxIdx = typedBuf.length;
    const cb = document.getElementById('cb-'+boxIdx);
    if (cb) {
      cb.textContent = ch.toUpperCase(); cb.className = 'char-box ng';
      setTimeout(() => { if(cb){ cb.textContent=''; cb.className='char-box cur'; }}, 380);
    }
    const monEl = document.getElementById('monster');
    monEl.classList.add('hurt');
    setTimeout(() => monEl.classList.remove('hurt'), 350);
    applyPenalty();
    showFeedback('âŒ ãƒŸã‚¹ï¼ï¼2ç§’','ng');
    if (combo > 0) { combo = 0; updateComboUI(true); }
  }
  updateHUD();
});

// ===== å˜èªã‚¯ãƒªã‚¢ =====
function onWordComplete() {
  cancelAnimationFrame(monsterRafId);
  kills++; combo++;
  const elapsed = (performance.now()-wordStartTime)/1000;
  let sm=1.0, sl='';
  if(elapsed<=2){sm=3.0;sl='âš¡Ã—3.0';}
  else if(elapsed<=4){sm=2.0;sl='ğŸ”¥Ã—2.0';}
  else if(elapsed<=6){sm=1.5;sl='âœ¨Ã—1.5';}
  else if(elapsed>10){sm=0.7;sl='Ã—0.7';}
  let cm=1.0, cl='';
  if(combo>=10){cm=3.0;cl='ğŸ”¥ã‚³ãƒ³ãƒœÃ—3.0';}
  else if(combo>=5){cm=2.0;cl='ğŸ’¥ã‚³ãƒ³ãƒœÃ—2.0';}
  else if(combo>=3){cm=1.5;cl='â­ã‚³ãƒ³ãƒœÃ—1.5';}
  const pts = Math.max(10, Math.round(currentWord.romaji.length*20*sm*cm));
  score += pts;

  document.getElementById('monster').classList.add('explode');
  document.getElementById('word-bubble').style.opacity='0';
  const lbl = [cl,sl].filter(Boolean).join(' ');
  showFeedback(`ğŸ’¥ ã‚„ã£ã¤ã‘ãŸï¼ ï¼‹${pts}pt${lbl?' ('+lbl+')':''}`, 'ok');
  spawnParticles();
  updateComboUI(false);
  updateHUD();
  showScorePopup(pts);
  setTimeout(() => { if (gameActive) loadWord(); }, 650);
}

// ===== UI =====
function updateComboUI(reset) {
  const el = document.getElementById('combo-value');
  el.textContent = combo;
  el.classList.remove('lv1','lv2','lv3','bump');
  if(combo>=10) el.classList.add('lv3');
  else if(combo>=5) el.classList.add('lv2');
  else if(combo>=3) el.classList.add('lv1');
  if (!reset && combo>0) { void el.offsetWidth; el.classList.add('bump'); }
  if (reset) {
    const rf = document.getElementById('combo-reset-flash');
    rf.classList.remove('show'); void rf.offsetWidth; rf.classList.add('show');
  }
}

function updateRomajiGuide() {
  if (!currentWord) return;
  const matched = currentVariants.find(v=>v.startsWith(typedBuf)) || currentWord.romaji;
  let html = '';
  for (let i=0; i<matched.length; i++) {
    if(i<typedBuf.length) html+=`<span class="done">${matched[i].toUpperCase()}</span>`;
    else if(i===typedBuf.length) html+=`<span class="next">${matched[i].toUpperCase()}</span>`;
    else html+=`<span class="rest">${matched[i].toUpperCase()}</span>`;
  }
  document.getElementById('romaji-guide').innerHTML = html;
}

function highlightNextKey() {
  document.querySelectorAll('.key.active-key').forEach(el=>el.classList.remove('active-key'));
  if (!currentWord) return;
  const matched = currentVariants.find(v=>v.startsWith(typedBuf)) || currentWord.romaji;
  if (typedBuf.length >= matched.length) return;
  const ch = matched[typedBuf.length];
  const el = document.getElementById(ch===' '?'key-space':'key-'+ch);
  if (el) el.classList.add('active-key');
  const fc = KEY_FINGER[ch] || 'fi';
  const color = FINGER_COLORS[fc];
  document.getElementById('next-key-hint').innerHTML =
    `æ¬¡ã®ã‚­ãƒ¼ï¼š<strong style="color:${color}">${ch.toUpperCase()}</strong>ã€€<span class="finger-tag" style="background:${color}22;border:1px solid ${color};color:${color}">${FINGER_NAMES[fc]}ã§ï¼</span>`;
}

function updateHUD() {
  document.getElementById('score-value').textContent = score;
  document.getElementById('kill-value').textContent = kills;
  const acc = totalTyped>0 ? Math.round(correctTyped/totalTyped*100) : 100;
  document.getElementById('acc-value').textContent = acc+'%';
  document.getElementById('combo-value').textContent = combo;
}

let feedbackTimer2 = null;
function showFeedback(msg, type) {
  const el = document.getElementById('feedback-msg');
  el.textContent = msg; el.className = 'feedback-msg '+type;
  clearTimeout(feedbackTimer2);
  feedbackTimer2 = setTimeout(() => clearFeedback(), 1100);
}
function clearFeedback() {
  const el = document.getElementById('feedback-msg');
  el.textContent = ''; el.className = 'feedback-msg';
}

function showScorePopup(pts) {
  const rect = document.getElementById('monster-stage').getBoundingClientRect();
  const p = document.createElement('div');
  p.className = 'score-popup';
  p.textContent = '+'+pts+'pt';
  p.style.left = (rect.left+rect.width/2-30)+'px';
  p.style.top = (rect.top+20)+'px';
  if(combo>=10) p.style.color='var(--red)';
  else if(combo>=5) p.style.color='var(--accent2)';
  else if(combo>=3) p.style.color='var(--green)';
  document.body.appendChild(p);
  setTimeout(() => p.remove(), 950);
}

function spawnParticles() {
  const colors=['#69f0ae','#00e5ff','#ffd740','#ff6b35','#a855f7','#ff6b6b'];
  const rect = document.getElementById('monster-stage').getBoundingClientRect();
  const cx=rect.left+rect.width/2, cy=rect.top+rect.height*.5;
  for (let i=0; i<22; i++) {
    const p=document.createElement('div'); p.className='particle';
    const sz=Math.random()*13+5, ang=Math.random()*Math.PI*2, dist=Math.random()*140+40;
    p.style.cssText=`width:${sz}px;height:${sz}px;background:${colors[i%colors.length]};left:${cx}px;top:${cy}px;--tx:${Math.cos(ang)*dist}px;--ty:${Math.sin(ang)*dist}px;--dur:${(.4+Math.random()*.5).toFixed(2)}s;`;
    document.body.appendChild(p);
    setTimeout(()=>p.remove(),800);
  }
}

// ===== ã‚²ãƒ¼ãƒ çµ‚äº† =====
function endGame() {
  stopGame();
  const acc = totalTyped>0 ? Math.round(correctTyped/totalTyped*100) : 100;
  document.getElementById('final-score').textContent = score+'pt';
  document.getElementById('final-stats').textContent = `ãŸãŠã—ãŸæ•°ï¼š${kills}ä½“ã€€æ­£ç¢ºç‡ï¼š${acc}%ã€€ã‚¿ã‚¤ãƒ—æ•°ï¼š${totalTyped}`;
  document.getElementById('player-name').value = '';
  document.getElementById('name-area').style.display = 'flex';
  renderRanking(null);
  showScreen('ranking-screen');
}

// ===== ãƒ©ãƒ³ã‚­ãƒ³ã‚° =====
const STORAGE_KEY = 'monster_typing_v4';
function saveRanking() {
  const name = document.getElementById('player-name').value.trim() || 'ã‚†ã†ã—ã‚ƒ';
  const acc = totalTyped>0 ? Math.round(correctTyped/totalTyped*100) : 100;
  const list = getStoredRanking();
  list.push({name, score, kills, acc});
  list.sort((a,b)=>b.score-a.score);
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(list.slice(0,10))); } catch(e){}
  document.getElementById('name-area').style.display = 'none';
  renderRanking(score);
}
function getStoredRanking() {
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; } catch{ return []; }
}
function renderRanking(hs) {
  const list = getStoredRanking();
  const el = document.getElementById('rank-list');
  const medals=['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
  if (!list.length) { el.innerHTML='<p style="color:#546e7a;text-align:center;padding:16px">ã¾ã è¨˜éŒ²ãŒãªã„ã‚ˆï¼</p>'; return; }
  let highlighted=false;
  el.innerHTML = list.map((r,i)=>{
    const isMe = hs!==null && !highlighted && r.score===hs;
    if(isMe) highlighted=true;
    return `<div class="rank-item ${isMe?'me':''}"><div class="rank-num">${i+1}</div><div class="rank-medal">${medals[i]||''}</div><div class="rank-name">${r.name}</div><div class="rank-score">${r.score}pt</div><div class="rank-acc">${r.acc}%</div></div>`;
  }).join('');
}

function shuffle(arr) {
  const a=[...arr];
  for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}
  return a;
}

// ===== èµ·å‹• =====
initStars();
buildKeyboard();
buildCategoryGrid();
renderRanking(null);
// ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç”»é¢ã‚’æœ€åˆã«è¡¨ç¤º
showScreen('license-screen');
</script>
</body>
</html>
